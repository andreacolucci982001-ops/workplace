<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workspace di Cinese - Impara Divertendoti</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #d32f2f;
            --primary-light: #ff6659;
            --primary-dark: #9a0007;
            --secondary: #ffcc00;
            --secondary-light: #ffff5a;
            --secondary-dark: #c79c00;
            --dark: #263238;
            --light: #f5f5f5;
            --gray: #757575;
            --success: #4caf50;
            --info: #2196f3;
        }
        
        body {
            background-color: #f9f9f9;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.8rem;
        }
        
        .logo i {
            margin-right: 10px;
            color: var(--secondary);
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            font-size: 2rem;
            margin: 15px 0 5px;
            text-align: center;
            width: 100%;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 25px;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--secondary);
            font-size: 1.3rem;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: var(--dark);
        }
        
        .btn-secondary:hover {
            background: var(--secondary-dark);
        }
        
        .btn-info {
            background: var(--info);
        }
        
        .btn-info:hover {
            background: #0b7dda;
        }
        
        .word-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            border-left: 5px solid var(--primary);
            transition: transform 0.3s;
        }
        
        .word-card:hover {
            transform: translateY(-3px);
        }
        
        .word-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .word-header h3 {
            font-size: 1.6rem;
            color: var(--primary);
        }
        
        .pinyin {
            color: var(--gray);
            font-style: italic;
            margin-bottom: 8px;
        }
        
        .translation {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 12px;
            padding: 8px;
            background-color: #fff9e6;
            border-radius: 6px;
        }
        
        .section-title {
            font-weight: 600;
            color: var(--primary);
            margin: 12px 0 5px;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 8px;
        }
        
        .associations, .example-sentence {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid var(--secondary);
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #e0e0e0;
        }
        
        .word-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .action-btn:hover {
            color: var(--primary);
            background-color: #f5f5f5;
        }
        
        .action-btn i {
            margin-right: 5px;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-box input {
            padding: 12px;
            font-size: 1rem;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }
        
        .filter-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 6px 12px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .word-count {
            text-align: center;
            margin-top: 15px;
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 15px;
            color: var(--gray);
            font-size: 0.85rem;
            border-top: 1px solid #eee;
        }
        
        .character-display {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 8px;
        }
        
        .tips {
            background-color: #e8f5e9;
            padding: 12px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid var(--success);
        }
        
        .tips h3 {
            color: var(--success);
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .tips p {
            font-size: 0.9rem;
        }
        
        /* Stili per la pagina audio */
        .page-container {
            display: none;
        }
        
        .page-container.active {
            display: block;
        }
        
        .audio-player {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .audio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .audio-title {
            font-size: 1.1rem;
            color: var(--primary);
        }
        
        .audio-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 12px;
        }
        
        .play-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .play-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }
        
        .progress-container {
            flex-grow: 1;
            height: 5px;
            background: #e0e0e0;
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            width: 0%;
        }
        
        .time-display {
            font-size: 0.85rem;
            color: var(--gray);
            min-width: 80px;
            text-align: right;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 30px 15px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background-color: #f9f9f9;
        }
        
        .upload-area i {
            font-size: 2.5rem;
            color: var(--gray);
            margin-bottom: 10px;
        }
        
        .audio-list {
            margin-top: 25px;
        }
        
        .audio-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid var(--info);
        }
        
        .audio-info {
            flex-grow: 1;
        }
        
        .audio-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .audio-meta {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .audio-actions {
            display: flex;
            gap: 8px;
        }
        
        .file-info {
            margin-top: 10px;
            padding: 8px;
            background: #f0f0f0;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        .status-message {
            padding: 8px 12px;
            border-radius: 6px;
            margin: 10px 0;
            display: none;
        }
        
        .status-success {
            background-color: #e8f5e9;
            color: var(--success);
            display: block;
        }
        
        .status-error {
            background-color: #ffebee;
            color: var(--primary);
            display: block;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-dragon"></i>
                <span>Workspace di Cinese</span>
            </div>
            
            <div class="nav-links">
                <a href="#" class="nav-link active" data-page="home">
                    <i class="fas fa-book"></i> Parole
                </a>
                <a href="#" class="nav-link" data-page="audio">
                    <i class="fas fa-music"></i> Audio
                </a>
            </div>
        </div>
        
        <h1>Impara il Cinese in Modo Divertente</h1>
        <p class="subtitle">Aggiungi parole, carica audio e memorizza il cinese con esempi pratici</p>
    </header>
    
    <div class="container">
        <!-- Pagina Home (Parole) -->
        <div id="home-page" class="page-container active">
            <div class="main-content">
                <!-- Form per aggiungere nuove parole -->
                <div class="left-column">
                    <div class="card">
                        <h2><i class="fas fa-plus-circle"></i> Aggiungi Nuova Parola</h2>
                        
                        <div class="form-group">
                            <label for="chinese-word">Parola Cinese (汉字)</label>
                            <input type="text" id="chinese-word" placeholder="Es: 你好" maxlength="10">
                        </div>
                        
                        <div class="form-group">
                            <label for="pinyin">Pinyin</label>
                            <input type="text" id="pinyin" placeholder="Es: nǐ hǎo">
                        </div>
                        
                        <div class="form-group">
                            <label for="translation">Traduzione in Italiano</label>
                            <input type="text" id="translation" placeholder="Es: Ciao">
                        </div>
                        
                        <div class="form-group">
                            <label for="associations">Associazioni / Mnemotecnica</label>
                            <textarea id="associations" placeholder="Es: 你 (nǐ) sembra un albero che saluta"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="example">Frase d'Esempio</label>
                            <textarea id="example" placeholder="Es: 你好吗？ (nǐ hǎo ma?) - Come stai?"></textarea>
                        </div>
                        
                        <button class="btn" id="add-word-btn">
                            <i class="fas fa-save"></i> Salva Parola
                        </button>
                        
                        <div class="tips">
                            <h3><i class="fas fa-lightbulb"></i> Suggerimento</h3>
                            <p>Crea associazioni visive o sonore con parole italiane per ricordare meglio i caratteri cinesi.</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="stats">
                            <div class="stat-item">
                                <div class="stat-number" id="total-words">0</div>
                                <div class="stat-label">Parole Totali</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="today-words">0</div>
                                <div class="stat-label">Oggi</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="review-count">0</div>
                                <div class="stat-label">Da Ripassare</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Visualizzazione parole esistenti -->
                <div class="right-column">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="Cerca parole, traduzioni o pinyin...">
                    </div>
                    
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="all">Tutte</button>
                        <button class="filter-btn" data-filter="recent">Recenti</button>
                        <button class="filter-btn" data-filter="review">Da Ripassare</button>
                        <button class="filter-btn" data-filter="favorite">Preferite</button>
                    </div>
                    
                    <div id="words-container">
                        <div class="empty-state" id="empty-state">
                            <i class="far fa-file-alt"></i>
                            <h3>Nessuna parola ancora</h3>
                            <p>Aggiungi la tua prima parola cinese!</p>
                        </div>
                    </div>
                    
                    <div class="word-count">
                        Mostrando <span id="display-count">0</span> parole su <span id="total-count">0</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pagina Audio -->
        <div id="audio-page" class="page-container">
            <div class="main-content">
                <div class="left-column">
                    <div class="card">
                        <h2><i class="fas fa-upload"></i> Carica Audio</h2>
                        
                        <div class="upload-area" id="upload-area">
                            <i class="fas fa-file-audio"></i>
                            <h3>Trascina o clicca per selezionare file audio</h3>
                            <p>MP3, WAV, OGG fino a 5MB</p>
                            <p class="file-info" id="file-info">Nessun file selezionato</p>
                        </div>
                        
                        <div id="audio-form">
                            <div class="form-group">
                                <label for="audio-title">Titolo Audio</label>
                                <input type="text" id="audio-title" placeholder="Es: Pronuncia di 你好">
                            </div>
                            
                            <div class="form-group">
                                <label for="audio-description">Descrizione (opzionale)</label>
                                <textarea id="audio-description" placeholder="Es: Pronuncia corretta di 'ciao'"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="audio-category">Categoria</label>
                                <select id="audio-category">
                                    <option value="pronuncia">Pronuncia</option>
                                    <option value="dialoghi">Dialoghi</option>
                                    <option value="canzoni">Canzoni</option>
                                    <option value="lezioni">Lezioni</option>
                                    <option value="altro">Altro</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-info" id="upload-audio-btn">
                                <i class="fas fa-cloud-upload-alt"></i> Carica Audio
                            </button>
                        </div>
                        
                        <div class="status-message" id="upload-status"></div>
                    </div>
                    
                    <div class="card">
                        <h2><i class="fas fa-headphones"></i> Player Audio</h2>
                        <div class="audio-player">
                            <div class="audio-header">
                                <div class="audio-title" id="current-audio-title">Nessun audio selezionato</div>
                            </div>
                            
                            <div class="audio-controls">
                                <button class="play-btn" id="play-btn">
                                    <i class="fas fa-play"></i>
                                </button>
                                
                                <div class="progress-container" id="progress-container">
                                    <div class="progress-bar" id="progress-bar"></div>
                                </div>
                                
                                <div class="time-display">
                                    <span id="current-time">0:00</span> / <span id="duration">0:00</span>
                                </div>
                            </div>
                            
                            <audio id="audio-element" preload="metadata"></audio>
                        </div>
                    </div>
                </div>
                
                <div class="right-column">
                    <div class="card">
                        <h2><i class="fas fa-list"></i> I Tuoi Audio</h2>
                        
                        <div class="search-box">
                            <input type="text" id="audio-search" placeholder="Cerca audio...">
                        </div>
                        
                        <div class="filter-buttons">
                            <button class="filter-btn active" data-audio-filter="all">Tutti</button>
                            <button class="filter-btn" data-audio-filter="pronuncia">Pronuncia</button>
                            <button class="filter-btn" data-audio-filter="dialoghi">Dialoghi</button>
                            <button class="filter-btn" data-audio-filter="lezioni">Lezioni</button>
                        </div>
                        
                        <div class="audio-list" id="audio-list">
                            <div class="empty-state">
                                <i class="fas fa-music"></i>
                                <h3>Nessun audio ancora</h3>
                                <p>Carica il tuo primo file audio!</p>
                            </div>
                        </div>
                        
                        <div class="word-count">
                            Audio: <span id="audio-display-count">0</span> su <span id="audio-total-count">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Workspace di Cinese - Le parole sono salvate nel tuo browser, gli audio localmente</p>
        </footer>
    </div>

    <script>
        // Stato dell'applicazione
        let words = [];
        let audios = [];
        let currentFilter = 'all';
        let currentAudioFilter = 'all';
        let searchQuery = '';
        let audioSearchQuery = '';
        let selectedAudioFile = null;
        
        // Riferimenti agli elementi del DOM
        const addWordBtn = document.getElementById('add-word-btn');
        const chineseWordInput = document.getElementById('chinese-word');
        const pinyinInput = document.getElementById('pinyin');
        const translationInput = document.getElementById('translation');
        const associationsInput = document.getElementById('associations');
        const exampleInput = document.getElementById('example');
        const wordsContainer = document.getElementById('words-container');
        const searchInput = document.getElementById('search-input');
        const totalWordsElement = document.getElementById('total-words');
        const todayWordsElement = document.getElementById('today-words');
        const reviewCountElement = document.getElementById('review-count');
        const displayCountElement = document.getElementById('display-count');
        const totalCountElement = document.getElementById('total-count');
        
        // Elementi navigazione
        const navLinks = document.querySelectorAll('.nav-link');
        const pageContainers = document.querySelectorAll('.page-container');
        
        // Elementi audio
        const uploadArea = document.getElementById('upload-area');
        const audioTitleInput = document.getElementById('audio-title');
        const audioDescriptionInput = document.getElementById('audio-description');
        const audioCategoryInput = document.getElementById('audio-category');
        const uploadAudioBtn = document.getElementById('upload-audio-btn');
        const uploadStatus = document.getElementById('upload-status');
        const fileInfo = document.getElementById('file-info');
        const audioList = document.getElementById('audio-list');
        const audioSearch = document.getElementById('audio-search');
        const audioDisplayCount = document.getElementById('audio-display-count');
        const audioTotalCount = document.getElementById('audio-total-count');
        const playBtn = document.getElementById('play-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = document.getElementById('progress-container');
        const currentTimeElement = document.getElementById('current-time');
        const durationElement = document.getElementById('duration');
        const audioElement = document.getElementById('audio-element');
        const currentAudioTitle = document.getElementById('current-audio-title');
        
        // Carica i dati all'avvio
        document.addEventListener('DOMContentLoaded', function() {
            loadWords();
            loadAudios();
            updateStats();
            renderWords();
            renderAudios();
            
            // Aggiungi parole di esempio se non ce ne sono
            if (words.length === 0) {
                addExampleWords();
            }
            
            // Aggiungi audio di esempio se non ce ne sono
            if (audios.length === 0) {
                addExampleAudios();
            }
        });
        
        // ========== NAVIGAZIONE ==========
        
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                const page = this.getAttribute('data-page');
                
                // Aggiorna link attivo
                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // Mostra la pagina corretta
                pageContainers.forEach(container => {
                    container.classList.remove('active');
                });
                
                document.getElementById(`${page}-page`).classList.add('active');
            });
        });
        
        // ========== GESTIONE PAROLE ==========
        
        // Aggiungi parola
        addWordBtn.addEventListener('click', function() {
            const chineseWord = chineseWordInput.value.trim();
            const pinyin = pinyinInput.value.trim();
            const translation = translationInput.value.trim();
            
            if (!chineseWord || !pinyin || !translation) {
                alert('Inserisci almeno la parola cinese, il pinyin e la traduzione.');
                return;
            }
            
            const newWord = {
                id: Date.now(),
                chinese: chineseWord,
                pinyin: pinyin,
                translation: translation,
                associations: associationsInput.value.trim(),
                example: exampleInput.value.trim(),
                dateAdded: new Date().toISOString().split('T')[0],
                lastReviewed: null,
                needsReview: true,
                favorite: false
            };
            
            words.unshift(newWord);
            saveWords();
            renderWords();
            updateStats();
            clearForm();
            
            // Feedback visivo
            addWordBtn.innerHTML = '<i class="fas fa-check"></i> Aggiunta!';
            addWordBtn.style.backgroundColor = 'var(--success)';
            
            setTimeout(() => {
                addWordBtn.innerHTML = '<i class="fas fa-save"></i> Salva Parola';
                addWordBtn.style.backgroundColor = '';
            }, 1500);
        });
        
        // Carica parole da localStorage
        function loadWords() {
            const savedWords = localStorage.getItem('chineseWords');
            if (savedWords) {
                words = JSON.parse(savedWords);
            }
        }
        
        // Salva parole in localStorage
        function saveWords() {
            localStorage.setItem('chineseWords', JSON.stringify(words));
        }
        
        // Pulisci il form
        function clearForm() {
            chineseWordInput.value = '';
            pinyinInput.value = '';
            translationInput.value = '';
            associationsInput.value = '';
            exampleInput.value = '';
            chineseWordInput.focus();
        }
        
        // Visualizza parole
        function renderWords() {
            let filteredWords = words;
            
            // Applica filtro
            if (currentFilter === 'recent') {
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                filteredWords = filteredWords.filter(word => {
                    const wordDate = new Date(word.dateAdded);
                    return wordDate >= oneWeekAgo;
                });
            } else if (currentFilter === 'review') {
                filteredWords = filteredWords.filter(word => word.needsReview);
            } else if (currentFilter === 'favorite') {
                filteredWords = filteredWords.filter(word => word.favorite);
            }
            
            // Applica ricerca
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filteredWords = filteredWords.filter(word => {
                    return word.chinese.toLowerCase().includes(query) ||
                           word.pinyin.toLowerCase().includes(query) ||
                           word.translation.toLowerCase().includes(query);
                });
            }
            
            // Aggiorna contatori
            displayCountElement.textContent = filteredWords.length;
            totalCountElement.textContent = words.length;
            
            // Se non ci sono parole
            if (filteredWords.length === 0) {
                wordsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="far fa-file-alt"></i>
                        <h3>Nessuna parola trovata</h3>
                        <p>${words.length === 0 ? 'Aggiungi la tua prima parola!' : 'Prova a cambiare filtro o ricerca'}</p>
                    </div>
                `;
                return;
            }
            
            // Crea le card delle parole
            let wordsHTML = '';
            filteredWords.forEach(word => {
                wordsHTML += `
                    <div class="word-card" data-id="${word.id}">
                        <div class="word-header">
                            <h3 class="character-display">${word.chinese}</h3>
                            <div>
                                <button class="action-btn ${word.favorite ? 'favorite' : ''}" onclick="toggleFavorite(${word.id})">
                                    <i class="${word.favorite ? 'fas' : 'far'} fa-star"></i>
                                </button>
                            </div>
                        </div>
                        <div class="pinyin">${word.pinyin}</div>
                        <div class="translation">${word.translation}</div>
                        
                        ${word.associations ? `
                            <div class="section-title"><i class="fas fa-brain"></i> Associazioni</div>
                            <div class="associations">${word.associations}</div>
                        ` : ''}
                        
                        ${word.example ? `
                            <div class="section-title"><i class="fas fa-comment"></i> Esempio</div>
                            <div class="example-sentence">${word.example}</div>
                        ` : ''}
                        
                        <div class="word-actions">
                            <button class="action-btn" onclick="markAsReviewed(${word.id})">
                                <i class="fas fa-check-circle"></i> Ripassata
                            </button>
                            <button class="action-btn" onclick="deleteWord(${word.id})">
                                <i class="fas fa-trash-alt"></i> Elimina
                            </button>
                        </div>
                    </div>
                `;
            });
            
            wordsContainer.innerHTML = wordsHTML;
        }
        
        // Aggiungi parole di esempio
        function addExampleWords() {
            const exampleWords = [
                {
                    id: 1,
                    chinese: '你好',
                    pinyin: 'nǐ hǎo',
                    translation: 'Ciao',
                    associations: '你 (nǐ) sembra una persona che si inchina',
                    example: '你好，我叫玛丽。 (nǐ hǎo, wǒ jiào mǎlì) - Ciao, mi chiamo Maria.',
                    dateAdded: new Date().toISOString().split('T')[0],
                    lastReviewed: null,
                    needsReview: true,
                    favorite: true
                },
                {
                    id: 2,
                    chinese: '谢谢',
                    pinyin: 'xiè xie',
                    translation: 'Grazie',
                    associations: '谢 (xiè) sembra una persona che ringrazia',
                    example: '谢谢你的帮助。 (xièxie nǐ de bāngzhù) - Grazie per il tuo aiuto.',
                    dateAdded: new Date().toISOString().split('T')[0],
                    lastReviewed: null,
                    needsReview: true,
                    favorite: true
                },
                {
                    id: 3,
                    chinese: '爱',
                    pinyin: 'ài',
                    translation: 'Amore',
                    associations: 'Sembra una persona che abbraccia un cuore',
                    example: '我爱你。 (wǒ ài nǐ) - Ti amo.',
                    dateAdded: '2023-10-03',
                    lastReviewed: '2023-10-10',
                    needsReview: false,
                    favorite: false
                }
            ];
            
            words = exampleWords;
            saveWords();
            updateStats();
        }
        
        // Aggiorna statistiche
        function updateStats() {
            totalWordsElement.textContent = words.length;
            
            const today = new Date().toISOString().split('T')[0];
            const todayWords = words.filter(word => word.dateAdded === today).length;
            todayWordsElement.textContent = todayWords;
            
            const reviewWords = words.filter(word => word.needsReview).length;
            reviewCountElement.textContent = reviewWords;
        }
        
        // Segna come ripassata
        function markAsReviewed(id) {
            const wordIndex = words.findIndex(word => word.id === id);
            if (wordIndex !== -1) {
                words[wordIndex].needsReview = false;
                words[wordIndex].lastReviewed = new Date().toISOString().split('T')[0];
                saveWords();
                renderWords();
                updateStats();
            }
        }
        
        // Elimina parola
        function deleteWord(id) {
            if (confirm('Eliminare questa parola?')) {
                words = words.filter(word => word.id !== id);
                saveWords();
                renderWords();
                updateStats();
            }
        }
        
        // Aggiungi/rimuovi preferiti
        function toggleFavorite(id) {
            const wordIndex = words.findIndex(word => word.id === id);
            if (wordIndex !== -1) {
                words[wordIndex].favorite = !words[wordIndex].favorite;
                saveWords();
                renderWords();
            }
        }
        
        // Ricerca parole
        searchInput.addEventListener('input', function() {
            searchQuery = this.value;
            renderWords();
        });
        
        // Filtri parole
        document.querySelectorAll('[data-filter]').forEach(button => {
            button.addEventListener('click', function() {
                currentFilter = this.getAttribute('data-filter');
                
                // Aggiorna stato attivo
                document.querySelectorAll('[data-filter]').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                renderWords();
            });
        });
        
        // ========== GESTIONE AUDIO ==========
        
        // Seleziona file audio
        uploadArea.addEventListener('click', function() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'audio/*';
            fileInput.multiple = false;
            
            fileInput.addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    selectedAudioFile = this.files[0];
                    
                    // Controlla dimensione (max 5MB)
                    if (selectedAudioFile.size > 5 * 1024 * 1024) {
                        showUploadStatus('File troppo grande! Massimo 5MB.', 'error');
                        selectedAudioFile = null;
                        fileInfo.textContent = 'Nessun file selezionato';
                        return;
                    }
                    
                    // Mostra informazioni file
                    fileInfo.textContent = `${selectedAudioFile.name} (${(selectedAudioFile.size / 1024 / 1024).toFixed(2)} MB)`;
                    
                    // Imposta titolo predefinito
                    audioTitleInput.value = selectedAudioFile.name.replace(/\.[^/.]+$/, "");
                    
                    // Mostra messaggio
                    showUploadStatus('File selezionato. Compila i dettagli e clicca "Carica Audio".', 'success');
                }
            });
            
            fileInput.click();
        });
        
        // Upload audio (salva localmente)
        uploadAudioBtn.addEventListener('click', function() {
            if (!selectedAudioFile) {
                showUploadStatus('Seleziona un file audio prima!', 'error');
                return;
            }
            
            const title = audioTitleInput.value.trim();
            if (!title) {
                showUploadStatus('Inserisci un titolo per l\'audio.', 'error');
                return;
            }
            
            // Leggi il file come URL
            const reader = new FileReader();
            reader.onload = function(e) {
                const newAudio = {
                    id: Date.now(),
                    title: title,
                    description: audioDescriptionInput.value.trim(),
                    category: audioCategoryInput.value,
                    fileName: selectedAudioFile.name,
                    fileSize: selectedAudioFile.size,
                    fileType: selectedAudioFile.type,
                    audioUrl: e.target.result, // Data URL
                    uploadedAt: new Date().toISOString()
                };
                
                audios.unshift(newAudio);
                saveAudios();
                renderAudios();
                
                // Resetta form
                resetAudioForm();
                
                showUploadStatus('Audio salvato correttamente!', 'success');
            };
            
            reader.readAsDataURL(selectedAudioFile);
        });
        
        // Carica audio da localStorage
        function loadAudios() {
            const savedAudios = localStorage.getItem('chineseAudios');
            if (savedAudios) {
                audios = JSON.parse(savedAudios);
            }
        }
        
        // Salva audio in localStorage
        function saveAudios() {
            localStorage.setItem('chineseAudios', JSON.stringify(audios));
        }
        
        // Visualizza audio
        function renderAudios() {
            let filteredAudios = audios;
            
            // Applica filtro categoria
            if (currentAudioFilter !== 'all') {
                filteredAudios = filteredAudios.filter(audio => audio.category === currentAudioFilter);
            }
            
            // Applica ricerca
            if (audioSearchQuery) {
                const query = audioSearchQuery.toLowerCase();
                filteredAudios = filteredAudios.filter(audio => {
                    return audio.title.toLowerCase().includes(query) ||
                           (audio.description && audio.description.toLowerCase().includes(query));
                });
            }
            
            // Aggiorna contatori
            audioDisplayCount.textContent = filteredAudios.length;
            audioTotalCount.textContent = audios.length;
            
            // Se non ci sono audio
            if (filteredAudios.length === 0) {
                audioList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-music"></i>
                        <h3>Nessun audio trovato</h3>
                        <p>${audios.length === 0 ? 'Carica il tuo primo audio!' : 'Prova a cambiare filtro o ricerca'}</p>
                    </div>
                `;
                return;
            }
            
            // Crea la lista audio
            let audioHTML = '';
            filteredAudios.forEach(audio => {
                const uploadDate = new Date(audio.uploadedAt).toLocaleDateString('it-IT');
                const fileSizeMB = (audio.fileSize / 1024 / 1024).toFixed(2);
                
                audioHTML += `
                    <div class="audio-item" data-id="${audio.id}">
                        <div class="audio-info">
                            <div class="audio-name">${audio.title}</div>
                            <div class="audio-meta">
                                ${audio.description ? `${audio.description} • ` : ''}
                                ${uploadDate} • ${fileSizeMB} MB
                            </div>
                        </div>
                        <div class="audio-actions">
                            <button class="action-btn" onclick="playAudio('${audio.audioUrl}', '${audio.title}')">
                                <i class="fas fa-play"></i> Ascolta
                            </button>
                            <button class="action-btn" onclick="deleteAudio(${audio.id})">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            audioList.innerHTML = audioHTML;
        }
        
        // Aggiungi audio di esempio
        function addExampleAudios() {
            // Non possiamo creare audio di esempio reali senza file audio
            // Ma possiamo creare dati di esempio
            const exampleAudios = [
                {
                    id: 1,
                    title: 'Pronuncia corretta di 你好',
                    description: 'Come dire "ciao" in cinese',
                    category: 'pronuncia',
                    fileName: 'nihao.mp3',
                    fileSize: 102400,
                    fileType: 'audio/mpeg',
                    audioUrl: '#', // Placeholder
                    uploadedAt: new Date().toISOString()
                },
                {
                    id: 2,
                    title: 'Dialogo base - Presentazioni',
                    description: 'Dialogo per presentarsi',
                    category: 'dialoghi',
                    fileName: 'dialogo.mp3',
                    fileSize: 204800,
                    fileType: 'audio/mpeg',
                    audioUrl: '#',
                    uploadedAt: new Date().toISOString()
                }
            ];
            
            audios = exampleAudios;
            saveAudios();
        }
        
        // Riproduci audio
        function playAudio(url, title) {
            // Se è un placeholder, mostra messaggio
            if (url === '#') {
                showUploadStatus('Questo è un audio di esempio. Carica i tuoi file audio per ascoltarli.', 'error');
                return;
            }
            
            // Imposta l'audio
            audioElement.src = url;
            currentAudioTitle.textContent = title;
            
            // Avvia la riproduzione
            audioElement.play();
            playBtn.innerHTML = '<i class="fas fa-pause"></i>';
            
            // Aggiorna la barra di progresso
            audioElement.addEventListener('timeupdate', updateProgress);
            audioElement.addEventListener('loadedmetadata', function() {
                durationElement.textContent = formatTime(audioElement.duration);
            });
            
            audioElement.addEventListener('ended', function() {
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                progressBar.style.width = '0%';
                currentTimeElement.textContent = '0:00';
            });
        }
        
        // Aggiorna barra di progresso
        function updateProgress() {
            const progressPercent = (audioElement.currentTime / audioElement.duration) * 100;
            progressBar.style.width = `${progressPercent}%`;
            currentTimeElement.textContent = formatTime(audioElement.currentTime);
        }
        
        // Formatta tempo
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        // Controlli player
        playBtn.addEventListener('click', function() {
            if (!audioElement.src || audioElement.src === '') {
                showUploadStatus('Seleziona un audio da riprodurre.', 'error');
                return;
            }
            
            if (audioElement.paused) {
                audioElement.play();
                this.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                audioElement.pause();
                this.innerHTML = '<i class="fas fa-play"></i>';
            }
        });
        
        // Clic sulla barra di progresso
        progressContainer.addEventListener('click', function(e) {
            if (!audioElement.duration) return;
            
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = audioElement.duration;
            
            audioElement.currentTime = (clickX / width) * duration;
        });
        
        // Elimina audio
        function deleteAudio(id) {
            if (confirm('Eliminare questo audio?')) {
                audios = audios.filter(audio => audio.id !== id);
                saveAudios();
                renderAudios();
                
                // Se l'audio eliminato era in riproduzione, ferma
                if (audioElement.src.includes(id)) {
                    audioElement.pause();
                    audioElement.src = '';
                    currentAudioTitle.textContent = 'Nessun audio selezionato';
                    playBtn.innerHTML = '<i class="fas fa-play"></i>';
                    progressBar.style.width = '0%';
                }
            }
        }
        
        // Ricerca audio
        audioSearch.addEventListener('input', function() {
            audioSearchQuery = this.value;
            renderAudios();
        });
        
        // Filtri audio
        document.querySelectorAll('[data-audio-filter]').forEach(button => {
            button.addEventListener('click', function() {
                currentAudioFilter = this.getAttribute('data-audio-filter');
                
                document.querySelectorAll('[data-audio-filter]').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                renderAudios();
            });
        });
        
        // Mostra messaggio di stato
        function showUploadStatus(message, type) {
            uploadStatus.textContent = message;
            uploadStatus.className = 'status-message';
            uploadStatus.classList.add(`status-${type}`);
            
            setTimeout(() => {
                uploadStatus.style.display = 'none';
            }, 3000);
        }
        
        // Resetta form audio
        function resetAudioForm() {
            selectedAudioFile = null;
            audioTitleInput.value = '';
            audioDescriptionInput.value = '';
            audioCategoryInput.value = 'pronuncia';
            fileInfo.textContent = 'Nessun file selezionato';
        }
        
        // Esponi funzioni globalmente
        window.toggleFavorite = toggleFavorite;
        window.markAsReviewed = markAsReviewed;
        window.deleteWord = deleteWord;
        window.playAudio = playAudio;
        window.deleteAudio = deleteAudio;
    </script>
</body>
</html>