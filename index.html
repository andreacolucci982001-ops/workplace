<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workspace- Impara Divertendoti</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #d32f2f;
            --primary-light: #ff6659;
            --primary-dark: #9a0007;
            --secondary: #ffcc00;
            --secondary-light: #ffff5a;
            --secondary-dark: #c79c00;
            --dark: #263238;
            --light: #f5f5f5;
            --gray: #757575;
            --success: #4caf50;
            --info: #2196f3;
            --purple: #9c27b0;
            --orange: #ff9800;
        }
        
        body {
            background-color: #f9f9f9;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.8rem;
        }
        
        .logo i {
            margin-right: 10px;
            color: var(--secondary);
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            font-size: 2rem;
            margin: 15px 0 5px;
            text-align: center;
            width: 100%;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 25px;
        }
        
        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-links {
                justify-content: center;
            }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--secondary);
            font-size: 1.3rem;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: var(--dark);
        }
        
        .btn-secondary:hover {
            background: var(--secondary-dark);
        }
        
        .btn-info {
            background: var(--info);
        }
        
        .btn-info:hover {
            background: #0b7dda;
        }
        
        .btn-purple {
            background: var(--purple);
        }
        
        .btn-purple:hover {
            background: #7b1fa2;
        }
        
        .btn-orange {
            background: var(--orange);
        }
        
        .btn-orange:hover {
            background: #e65100;
        }
        
        .word-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            border-left: 5px solid var(--primary);
            transition: transform 0.3s;
        }
        
        .word-card:hover {
            transform: translateY(-3px);
        }
        
        .word-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .word-header h3 {
            font-size: 1.6rem;
            color: var(--primary);
        }
        
        .word-category {
            display: inline-block;
            padding: 3px 8px;
            background: #e8f5e9;
            color: var(--success);
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .pinyin {
            color: var(--gray);
            font-style: italic;
            margin-bottom: 8px;
        }
        
        .translation {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 12px;
            padding: 8px;
            background-color: #fff9e6;
            border-radius: 6px;
        }
        
        .section-title {
            font-weight: 600;
            color: var(--primary);
            margin: 12px 0 5px;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 8px;
        }
        
        .associations, .example-sentence {
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid var(--secondary);
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #e0e0e0;
        }
        
        .word-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .action-btn:hover {
            color: var(--primary);
            background-color: #f5f5f5;
        }
        
        .action-btn i {
            margin-right: 5px;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-box input {
            padding: 12px;
            font-size: 1rem;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }
        
        .filter-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 6px 12px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .word-count {
            text-align: center;
            margin-top: 15px;
            color: var(--gray);
            font-size: 0.85rem;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 15px;
            color: var(--gray);
            font-size: 0.85rem;
            border-top: 1px solid #eee;
        }
        
        .character-display {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 8px;
        }
        
        .tips {
            background-color: #e8f5e9;
            padding: 12px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid var(--success);
        }
        
        .tips h3 {
            color: var(--success);
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .tips p {
            font-size: 0.9rem;
        }
        
        /* Stili per la pagina audio */
        .page-container {
            display: none;
        }
        
        .page-container.active {
            display: block;
        }
        
        .audio-player {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .audio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .audio-title {
            font-size: 1.1rem;
            color: var(--primary);
        }
        
        .audio-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 12px;
        }
        
        .play-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .play-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }
        
        .progress-container {
            flex-grow: 1;
            height: 5px;
            background: #e0e0e0;
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--primary);
            border-radius: 3px;
            width: 0%;
        }
        
        .time-display {
            font-size: 0.85rem;
            color: var(--gray);
            min-width: 80px;
            text-align: right;
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 30px 15px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background-color: #f9f9f9;
        }
        
        .upload-area i {
            font-size: 2.5rem;
            color: var(--gray);
            margin-bottom: 10px;
        }
        
        .audio-list {
            margin-top: 25px;
        }
        
        .audio-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid var(--info);
        }
        
        .audio-info {
            flex-grow: 1;
        }
        
        .audio-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .audio-meta {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .audio-actions {
            display: flex;
            gap: 8px;
        }
        
        .file-info {
            margin-top: 10px;
            padding: 8px;
            background: #f0f0f0;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        .status-message {
            padding: 8px 12px;
            border-radius: 6px;
            margin: 10px 0;
            display: none;
        }
        
        .status-success {
            background-color: #e8f5e9;
            color: var(--success);
            display: block;
        }
        
        .status-error {
            background-color: #ffebee;
            color: var(--primary);
            display: block;
        }
        
        /* Stili per la pagina disegno e note */
        .drawing-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 900px) {
            .drawing-container {
                grid-template-columns: 1fr;
            }
        }
        
        .drawing-area {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .canvas-container {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            margin-bottom: 15px;
        }
        
        #drawing-canvas {
            display: block;
            background: white;
            cursor: crosshair;
        }
        
        .drawing-tools {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .tool-btn {
            padding: 8px 12px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .tool-btn:hover, .tool-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .color-option {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #eee;
            transition: transform 0.2s;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.active {
            border-color: var(--dark);
            transform: scale(1.1);
        }
        
        .brush-size {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .brush-size input {
            width: 120px;
        }
        
        .notes-container {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .notes-list {
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .note-item {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid var(--purple);
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .note-title {
            font-weight: 600;
            color: var(--purple);
        }
        
        .note-date {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .note-content {
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .note-actions {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }
        
        .drawings-list {
            margin-top: 25px;
        }
        
        .drawing-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .drawing-preview {
            background: #f9f9f9;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
            text-align: center;
        }
        
        .drawing-canvas-preview {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .drawing-meta {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }
        
        /* Stili per la pagina calendario */
        .calendar-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 900px) {
            .calendar-container {
                grid-template-columns: 1fr;
            }
        }
        
        .events-list {
            margin-top: 20px;
        }
        
        .event-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 5px solid var(--orange);
        }
        
        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .event-title {
            font-weight: 600;
            color: var(--orange);
        }
        
        .event-date {
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: 600;
        }
        
        .event-description {
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .event-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* Stili per la pagina statistiche */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .chart-title {
            color: var(--primary);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border-top: 4px solid var(--primary);
        }
        
        .stat-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .stat-card .number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark);
        }
        
        /* Categorie */
        .category-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .category-form {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .categories-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .category-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: #e8f5e9;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
        }
        
        .category-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .remove-category {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        /* Stili per la pagina Quiz */
        .quiz-input-area {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background-color: #f9f9f9;
            margin-bottom: 15px;
        }
        
        .quiz-input-area h3 {
            margin-bottom: 10px;
            color: #2196f3;
            font-size: 1.1rem;
        }
        
        .quiz-textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: monospace;
            resize: vertical;
        }
        
        .quiz-example {
            background-color: #f0f0f0;
            padding: 8px 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #757575;
        }
        
        .quiz-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .quiz-control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quiz-control-group label {
            margin-bottom: 0;
            white-space: nowrap;
        }
        
        .quiz-control-group select, .quiz-control-group input {
            width: auto;
            min-width: 120px;
        }
        
        .quiz-question {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #2196f3;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .quiz-question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .quiz-question-number {
            font-weight: 700;
            color: #2196f3;
            font-size: 1.2rem;
        }
        
        .quiz-question-type {
            background-color: #2196f3;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .quiz-question-text {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 20px;
            padding: 12px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }
        
        .quiz-answers {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
        }
        
        .quiz-answer {
            padding: 15px;
            background-color: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }
        
        .quiz-answer:hover {
            background-color: #f0f8ff;
            border-color: #2196f3;
            transform: translateY(-2px);
        }
        
        .quiz-answer.correct {
            border-color: #4caf50;
            background-color: #e8f5e9;
            color: #155724;
            position: relative;
        }
        
        .quiz-answer.correct::after {
            content: "✓ Corretta";
            position: absolute;
            right: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .quiz-answer.incorrect {
            border-color: #d32f2f;
            background-color: #ffebee;
            color: #721c24;
            position: relative;
        }
        
        .quiz-answer.incorrect::after {
            content: "✗ Sbagliata";
            position: absolute;
            right: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .quiz-answer.disabled {
            opacity: 0.6;
            cursor: default;
        }
        
        .quiz-answer.disabled:hover {
            background-color: white;
            border-color: #e0e0e0;
            transform: none;
        }
        
        .quiz-feedback {
            margin-top: 15px;
            padding: 12px 15px;
            background-color: #e8f4f8;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
            display: none;
        }
        
        .quiz-feedback.show {
            display: block;
        }
        
        .quiz-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .quiz-results {
            text-align: center;
            font-weight: 500;
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            background-color: #e8f5e9;
            color: #155724;
        }
        
        .quiz-results.show {
            display: block;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-dragon"></i>
                <span>Workspace</span>
            </div>
            
            <div class="nav-links">
                <a href="#" class="nav-link active" data-page="calendar">
                    <i class="fas fa-calendar-alt"></i> Calendario
                </a>
                <a href="#" class="nav-link" data-page="home">
                    <i class="fas fa-book"></i> Parole
                </a>
                <a href="#" class="nav-link" data-page="quiz">
                    <i class="fas fa-question-circle"></i> Quiz
                </a>
                <a href="#" class="nav-link" data-page="audio">
                    <i class="fas fa-music"></i> Audio
                </a>
                <a href="#" class="nav-link" data-page="drawing">
                    <i class="fas fa-paint-brush"></i> Disegno & Note
                </a>
                <a href="#" class="nav-link" data-page="stats">
                    <i class="fas fa-chart-line"></i> Statistiche
                </a>
            </div>
        </div>
        
        <h1>Impara Le lingue in Modo Divertente</h1>
        <p class="subtitle">Pianifica, impara, pratica e traccia i tuoi progressi - tutto in un unico posto</p>
    </header>
    
    <div class="container">
        <!-- Pagina Calendario -->
        <div id="calendar-page" class="page-container active">
            <div class="main-content">
                <div class="left-column">
                    <div class="card">
                        <h2><i class="fas fa-calendar-plus"></i> Aggiungi Evento</h2>
                        
                        <div class="form-group">
                            <label for="event-title">Titolo Evento</label>
                            <input type="text" id="event-title" placeholder="Es: Lezione di cinese, Esame HSK, ...">
                        </div>
                        
                        <div class="form-group">
                            <label for="event-date">Data</label>
                            <input type="date" id="event-date">
                        </div>
                        
                        <div class="form-group">
                            <label for="event-time">Orario (opzionale)</label>
                            <input type="time" id="event-time">
                        </div>
                        
                        <div class="form-group">
                            <label for="event-description">Descrizione</label>
                            <textarea id="event-description" placeholder="Es: Portare libro di testo, ripassare vocabolario..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="event-type">Tipo di Evento</label>
                            <select id="event-type">
                                <option value="lezione">Lezione</option>
                                <option value="esame">Esame/Test</option>
                                <option value="pratica">Sessione di Pratica</option>
                                <option value="incontro">Incontro Lingua</option>
                                <option value="piano">Piano</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-orange" id="add-event-btn">
                            <i class="fas fa-plus-circle"></i> Aggiungi Evento
                        </button>
                        
                        <div class="tips">
                            <h3><i class="fas fa-lightbulb"></i> Suggerimento</h3>
                            <p>Pianifica le tue sessioni di studio regolarmente per massimizzare la ritenzione delle parole cinesi!</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2><i class="fas fa-chart-pie"></i> Eventi Prossimi</h2>
                        <div class="stats">
                            <div class="stat-item">
                                <div class="stat-number" id="total-events">0</div>
                                <div class="stat-label">Eventi Totali</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="upcoming-events">0</div>
                                <div class="stat-label">Prossimi 7 giorni</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="right-column">
                    <div class="card">
                        <h2><i class="fas fa-calendar-day"></i> I Tuoi Eventi</h2>
                        
                        <div class="search-box">
                            <input type="text" id="event-search" placeholder="Cerca eventi...">
                        </div>
                        
                        <div class="filter-buttons">
                            <button class="filter-btn active" data-event-filter="all">Tutti</button>
                            <button class="filter-btn" data-event-filter="upcoming">Prossimi</button>
                            <button class="filter-btn" data-event-filter="piano">Piano</button>
                            <button class="filter-btn" data-event-filter="esame">Esami</button>
                        </div>
                        
                        <div class="events-list" id="events-list">
                            <div class="empty-state">
                                <i class="far fa-calendar"></i>
                                <h3>Nessun evento ancora</h3>
                                <p>Aggiungi il tuo primo evento al calendario!</p>
                            </div>
                        </div>
                        
                        <div class="word-count">
                            Mostrando <span id="events-display-count">0</span> eventi
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pagina Parole -->
        <div id="home-page" class="page-container">
            <div class="main-content">
                <div class="left-column">
                    <div class="card">
                        <h2><i class="fas fa-plus-circle"></i> Aggiungi Nuova Parola</h2>
                        
                        <div class="form-group">
                            <label for="chinese-word">Parola Cinese (汉字)</label>
                            <input type="text" id="chinese-word" placeholder="Es: 你好" maxlength="10">
                        </div>
                        
                        <div class="form-group">
                            <label for="pinyin">Pinyin</label>
                            <input type="text" id="pinyin" placeholder="Es: nǐ hǎo">
                        </div>
                        
                        <div class="form-group">
                            <label for="translation">Traduzione in Italiano</label>
                            <input type="text" id="translation" placeholder="Es: Ciao">
                        </div>
                        
                        <div class="form-group">
                            <label for="word-category">Categoria</label>
                            <div style="display: flex; gap: 10px;">
                                <select id="word-category" style="flex: 1;">
                                    <option value="generale">Generale</option>
                                </select>
                                <button type="button" class="btn btn-secondary" id="manage-categories-btn" style="padding: 10px;">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="associations">Associazioni / Mnemotecnica</label>
                            <textarea id="associations" placeholder="Es: 你 (nǐ) sembra un albero che saluta"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="example">Frase d'Esempio</label>
                            <textarea id="example" placeholder="Es: 你好吗？ (nǐ hǎo ma?) - Come stai?"></textarea>
                        </div>
                        
                        <button class="btn" id="add-word-btn">
                            <i class="fas fa-save"></i> Salva Parola
                        </button>
                        
                        <div class="category-form" id="category-form" style="display: none;">
                            <h3 style="margin-top: 0; margin-bottom: 10px; font-size: 1.1rem;"><i class="fas fa-tags"></i> Gestisci Categorie</h3>
                            <div class="form-group">
                                <label for="new-category-name">Nuova Categoria</label>
                                <input type="text" id="new-category-name" placeholder="Nome categoria">
                            </div>
                            <div class="form-group">
                                <label for="new-category-color">Colore</label>
                                <input type="color" id="new-category-color" value="#4caf50">
                            </div>
                            <button class="btn btn-secondary" id="add-category-btn">
                                <i class="fas fa-plus"></i> Aggiungi Categoria
                            </button>
                            
                            <div class="categories-list" id="categories-list">
                                <!-- Le categorie verranno caricate qui -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="stats">
                            <div class="stat-item">
                                <div class="stat-number" id="total-words">0</div>
                                <div class="stat-label">Parole Totali</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="today-words">0</div>
                                <div class="stat-label">Oggi</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="review-count">0</div>
                                <div class="stat-label">Da Ripassare</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="right-column">
                    <div class="card">
                        <h2><i class="fas fa-book-open"></i> Le Tue Parole</h2>
                        
                        <div class="search-box">
                            <input type="text" id="search-input" placeholder="Cerca parole, traduzioni o pinyin...">
                        </div>
                        
                        <div class="filter-buttons">
                            <button class="filter-btn active" data-filter="all">Tutte</button>
                            <button class="filter-btn" data-filter="recent">Recenti</button>
                            <button class="filter-btn" data-filter="review">Da Ripassare</button>
                            <button class="filter-btn" data-filter="favorite">Preferite</button>
                            <button class="filter-btn" data-filter="category">Per Categoria</button>
                        </div>
                        
                        <div id="category-filter-buttons" style="display: none; margin-bottom: 15px;">
                            <!-- I pulsanti per le categorie verranno aggiunti qui dinamicamente -->
                        </div>
                        
                        <div id="words-container">
                            <div class="empty-state" id="empty-state">
                                <i class="far fa-file-alt"></i>
                                <h3>Nessuna parola ancora</h3>
                                <p>Aggiungi la tua prima parola cinese!</p>
                            </div>
                        </div>
                        
                        <div class="word-count">
                            Mostrando <span id="display-count">0</span> parole su <span id="total-count">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pagina Quiz -->
        <div id="quiz-page" class="page-container">
            <div class="main-content">
                <div class="left-column">
                    <div class="card">
                        <h2><i class="fas fa-cogs"></i> Genera Quiz</h2>
                        
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <button class="filter-btn active" data-quiz-source="manual">Inserisci Manualmente</button>
                            <button class="filter-btn" data-quiz-source="workspace">Usa Parole Workspace</button>
                        </div>
                        
                        <div id="quiz-manual-input" class="quiz-input-area">
                            <h3><i class="fas fa-keyboard"></i> Inserisci Parole Manualmente</h3>
                            <p>Inserisci ogni parola in una riga separata, nel formato: <strong>pinyin - traduzione italiana</strong></p>
                            <textarea id="quiz-word-list" class="quiz-textarea" placeholder="nǐ hǎo - ciao
xièxie - grazie
zàijiàn - arrivederci
qǐng wèn - per favore / scusi"></textarea>
                            <div class="quiz-example">
                                <strong>Esempio:</strong><br>
                                nǐ hǎo - ciao<br>
                                xièxie - grazie<br>
                                zàijiàn - arrivederci
                            </div>
                        </div>
                        
                        <div id="quiz-workspace-info" class="quiz-input-area" style="display: none;">
                            <h3><i class="fas fa-database"></i> Parole da Workspace</h3>
                            <p>Usa le <strong><span id="workspace-word-count">0</span> parole</strong> che hai salvato in Workspace per generare il quiz.</p>
                            <div class="form-group">
                                <label for="quiz-category-filter">Filtra per categoria (opzionale)</label>
                                <select id="quiz-category-filter">
                                    <option value="all">Tutte le categorie</option>
                                </select>
                            </div>
                            <div class="tips">
                                <h3><i class="fas fa-info-circle"></i> Informazioni</h3>
                                <p>Le parole verranno prese automaticamente dalla tua raccolta Workspace. Puoi filtrare per categoria se vuoi quiz mirati.</p>
                            </div>
                        </div>
                        
                        <div class="quiz-controls">
                            <div class="quiz-control-group">
                                <label for="quiz-direction">Tipo di domande:</label>
                                <select id="quiz-direction">
                                    <option value="both">Entrambe le direzioni</option>
                                    <option value="pinyin-to-italian">Pinyin → Italiano</option>
                                    <option value="italian-to-pinyin">Italiano → Pinyin</option>
                                </select>
                            </div>
                            
                            <div class="quiz-control-group">
                                <label for="quiz-num-questions">Numero di domande:</label>
                                <input type="number" id="quiz-num-questions" min="1" max="50" value="10">
                            </div>
                            
                            <div class="quiz-control-group">
                                <label for="quiz-num-choices">Risposte per domanda:</label>
                                <input type="number" id="quiz-num-choices" min="2" max="6" value="4">
                            </div>
                        </div>
                        
                        <button class="btn btn-info" id="generate-quiz-btn">
                            <i class="fas fa-play-circle"></i> Genera Quiz
                        </button>
                        
                        <div class="tips">
                            <h3><i class="fas fa-lightbulb"></i> Suggerimenti</h3>
                            <p>1. Per apprendimento ottimale, prima scroll down SENZA vedere le opzioni.</p>
                            <p>2. Usa sia domande da pinyin a italiano che da italiano a pinyin.</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="stats">
                            <div class="stat-item">
                                <div class="stat-number" id="quiz-total-words">0</div>
                                <div class="stat-label">Parole Workspace</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="quiz-today-score">0</div>
                                <div class="stat-label">Punteggio Oggi</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="right-column">
                    <div class="card">
                        <h2><i class="fas fa-question-circle"></i> Il Tuo Quiz</h2>
                        
                        <div class="quiz-stats" id="quiz-stats" style="display: none;">
                            <div id="quiz-stats-text">Domande: 0 | Corrette: 0 | Sbagliate: 0</div>
                            <button class="btn btn-secondary" id="reset-quiz-btn">
                                <i class="fas fa-redo"></i> Ripristina
                            </button>
                        </div>
                        
                        <div id="quiz-questions-container">
                            <div class="empty-state">
                                <i class="fas fa-question"></i>
                                <h3>Nessun quiz generato</h3>
                                <p>Configura le impostazioni e clicca "Genera Quiz" per iniziare!</p>
                            </div>
                        </div>
                        
                        <div id="quiz-results" class="quiz-results"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pagina Audio -->
        <div id="audio-page" class="page-container">
            <div class="main-content">
                <div class="left-column">
                    <div class="card">
                        <h2><i class="fas fa-upload"></i> Carica Audio</h2>
                        
                        <div class="upload-area" id="upload-area">
                            <i class="fas fa-file-audio"></i>
                            <h3>Trascina o clicca per selezionare file audio</h3>
                            <p>MP3, WAV, OGG fino a 5MB</p>
                            <p class="file-info" id="file-info">Nessun file selezionato</p>
                        </div>
                        
                        <div id="audio-form">
                            <div class="form-group">
                                <label for="audio-title">Titolo Audio</label>
                                <input type="text" id="audio-title" placeholder="Es: Pronuncia di 你好">
                            </div>
                            
                            <div class="form-group">
                                <label for="audio-description">Descrizione (opzionale)</label>
                                <textarea id="audio-description" placeholder="Es: Pronuncia corretta di 'ciao'"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="audio-category">Categoria</label>
                                <select id="audio-category">
                                    <option value="pronuncia">Pronuncia</option>
                                    <option value="dialoghi">Dialoghi</option>
                                    <option value="canzoni">Canzoni</option>
                                    <option value="piano">piano</option>
                                    <option value="altro">Altro</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-info" id="upload-audio-btn">
                                <i class="fas fa-cloud-upload-alt"></i> Carica Audio
                            </button>
                        </div>
                        
                        <div class="status-message" id="upload-status"></div>
                    </div>
                    
                    <div class="card">
                        <h2><i class="fas fa-headphones"></i> Player Audio</h2>
                        <div class="audio-player">
                            <div class="audio-header">
                                <div class="audio-title" id="current-audio-title">Nessun audio selezionato</div>
                            </div>
                            
                            <div class="audio-controls">
                                <button class="play-btn" id="play-btn">
                                    <i class="fas fa-play"></i>
                                </button>
                                
                                <div class="progress-container" id="progress-container">
                                    <div class="progress-bar" id="progress-bar"></div>
                                </div>
                                
                                <div class="time-display">
                                    <span id="current-time">0:00</span> / <span id="duration">0:00</span>
                                </div>
                            </div>
                            
                            <audio id="audio-element" preload="metadata"></audio>
                        </div>
                    </div>
                </div>
                
                <div class="right-column">
                    <div class="card">
                        <h2><i class="fas fa-list"></i> I Tuoi Audio</h2>
                        
                        <div class="search-box">
                            <input type="text" id="audio-search" placeholder="Cerca audio...">
                        </div>
                        
                        <div class="filter-buttons">
                            <button class="filter-btn active" data-audio-filter="all">Tutti</button>
                            <button class="filter-btn" data-audio-filter="pronuncia">Pronuncia</button>
                            <button class="filter-btn" data-audio-filter="dialoghi">Dialoghi</button>
                            <button class="filter-btn" data-audio-filter="lezioni">Lezioni</button>
                        </div>
                        
                        <div class="audio-list" id="audio-list">
                            <div class="empty-state">
                                <i class="fas fa-music"></i>
                                <h3>Nessun audio ancora</h3>
                                <p>Carica il tuo primo file audio!</p>
                            </div>
                        </div>
                        
                        <div class="word-count">
                            Audio: <span id="audio-display-count">0</span> su <span id="audio-total-count">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pagina Disegno e Note -->
        <div id="drawing-page" class="page-container">
            <div class="main-content">
                <div class="left-column">
                    <div class="card">
                        <h2><i class="fas fa-paint-brush"></i> Disegna Caratteri Cinesi</h2>
                        
                        <div class="canvas-container">
                            <canvas id="drawing-canvas" width="400" height="300"></canvas>
                        </div>
                        
                        <div class="drawing-tools">
                            <div class="tool-btn active" data-tool="brush">
                                <i class="fas fa-paint-brush"></i> Pennello
                            </div>
                            <div class="tool-btn" data-tool="eraser">
                                <i class="fas fa-eraser"></i> Gomma
                            </div>
                            <div class="tool-btn" data-tool="clear">
                                <i class="fas fa-trash"></i> Cancella Tutto
                            </div>
                        </div>
                        
                        <div class="color-picker">
                            <span>Colore:</span>
                            <div class="color-option active" style="background-color: #000000;" data-color="#000000"></div>
                            <div class="color-option" style="background-color: #d32f2f;" data-color="#d32f2f"></div>
                            <div class="color-option" style="background-color: #2196f3;" data-color="#2196f3"></div>
                            <div class="color-option" style="background-color: #4caf50;" data-color="#4caf50"></div>
                            <div class="color-option" style="background-color: #9c27b0;" data-color="#9c27b0"></div>
                        </div>
                        
                        <div class="brush-size">
                            <span>Dimensione:</span>
                            <input type="range" id="brush-size" min="1" max="20" value="5">
                            <span id="brush-size-value">5px</span>
                        </div>
                        
                        <div class="form-group" style="margin-top: 15px;">
                            <label for="drawing-title">Titolo del Disegno</label>
                            <input type="text" id="drawing-title" placeholder="Es: Pratica di 你好">
                        </div>
                        
                        <div class="form-group">
                            <label for="drawing-description">Descrizione (opzionale)</label>
                            <textarea id="drawing-description" placeholder="Es: Ordine dei tratti per 你"></textarea>
                        </div>
                        
                        <button class="btn btn-purple" id="save-drawing-btn">
                            <i class="fas fa-save"></i> Salva Disegno
                        </button>
                        
                        <div class="tips">
                            <h3><i class="fas fa-graduation-cap"></i> Consiglio</h3>
                            <p>Disegna i caratteri seguendo l'ordine corretto dei tratti. Inizia dall'alto verso il basso, da sinistra a destra.</p>
                        </div>
                    </div>
                </div>
                
                <div class="right-column">
                    <div class="card">
                        <h2><i class="fas fa-sticky-note"></i> Le Tue Note</h2>
                        
                        <div class="form-group">
                            <label for="note-title">Titolo della Nota</label>
                            <input type="text" id="note-title" placeholder="Es: Regole del tono 3">
                        </div>
                        
                        <div class="form-group">
                            <label for="note-content">Contenuto della Nota</label>
                            <textarea id="note-content" rows="5" placeholder="Scrivi qui le tue osservazioni, regole grammaticali, ecc..."></textarea>
                        </div>
                        
                        <button class="btn btn-purple" id="save-note-btn">
                            <i class="fas fa-plus-circle"></i> Aggiungi Nota
                        </button>
                        
                        <div class="notes-list" id="notes-list">
                            <div class="empty-state">
                                <i class="far fa-sticky-note"></i>
                                <h3>Nessuna nota ancora</h3>
                                <p>Aggiungi la tua prima nota!</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2><i class="fas fa-history"></i> I Tuoi Disegni Salvati</h2>
                        
                        <div class="drawings-list" id="drawings-list">
                            <div class="empty-state">
                                <i class="far fa-image"></i>
                                <h3>Nessun disegno ancora</h3>
                                <p>Crea il tuo primo disegno!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pagina Statistiche -->
        <div id="stats-page" class="page-container">
            <div class="main-content">
                <div class="left-column">
                    <div class="card">
                        <h2><i class="fas fa-chart-line"></i> Progresso Apprendimento</h2>
                        
                        <div class="chart-container">
                            <h3 class="chart-title">Parole Imparate per Giorno</h3>
                            <canvas id="words-chart"></canvas>
                        </div>
                        
                        <div class="chart-container">
                            <h3 class="chart-title">Distribuzione per Categoria</h3>
                            <canvas id="categories-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="right-column">
                    <div class="card">
                        <h2><i class="fas fa-trophy"></i> Le Tue Statistiche</h2>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h3>Parole Totali</h3>
                                <div class="number" id="stats-total-words">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Parole Oggi</h3>
                                <div class="number" id="stats-today-words">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Da Ripassare</h3>
                                <div class="number" id="stats-review-words">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Preferite</h3>
                                <div class="number" id="stats-favorite-words">0</div>
                            </div>
                        </div>
                        
                        <div class="stats-grid" style="margin-top: 20px;">
                            <div class="stat-card">
                                <h3>Audio</h3>
                                <div class="number" id="stats-audio-count">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Disegni</h3>
                                <div class="number" id="stats-drawings-count">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Note</h3>
                                <div class="number" id="stats-notes-count">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Eventi</h3>
                                <div class="number" id="stats-events-count">0</div>
                            </div>
                        </div>
                        
                        <div class="tips" style="margin-top: 20px;">
                            <h3><i class="fas fa-star"></i> Tracciamento Progresso</h3>
                            <p>Il grafico mostra quante parole hai imparato ogni giorno. Cerca di mantenere una streak continua!</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2><i class="fas fa-calendar-check"></i> Attività Recente</h2>
                        <div id="recent-activity">
                            <div class="empty-state">
                                <i class="fas fa-history"></i>
                                <h3>Nessuna attività ancora</h3>
                                <p>Inizia ad aggiungere parole per vedere la tua attività!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Workspace - Tutti i dati sono salvati nel tuo browser</p>
            <p>Per esportare i dati, usa gli strumenti di sviluppo del browser (Console → localStorage)</p>
        </footer>
    </div>

    <script>
        // Stato dell'applicazione
        let words = [];
        let audios = [];
        let drawings = [];
        let notes = [];
        let events = [];
        let categories = [];
        
        // Variabili per il quiz
        let quizQuestions = [];
        let quizScore = { correct: 0, total: 0 };
        let currentQuizSource = 'manual';
        
        let currentFilter = 'all';
        let currentAudioFilter = 'all';
        let currentEventFilter = 'all';
        let searchQuery = '';
        let audioSearchQuery = '';
        let eventSearchQuery = '';
        let selectedAudioFile = null;
        let selectedCategoryFilter = '';
        
        // Variabili per il disegno
        let currentTool = 'brush';
        let currentColor = '#000000';
        let brushSize = 5;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        
        // Grafici
        let wordsChart = null;
        let categoriesChart = null;
        
        // Riferimenti agli elementi del DOM
        const addWordBtn = document.getElementById('add-word-btn');
        const chineseWordInput = document.getElementById('chinese-word');
        const pinyinInput = document.getElementById('pinyin');
        const translationInput = document.getElementById('translation');
        const associationsInput = document.getElementById('associations');
        const exampleInput = document.getElementById('example');
        const wordsContainer = document.getElementById('words-container');
        const searchInput = document.getElementById('search-input');
        const totalWordsElement = document.getElementById('total-words');
        const todayWordsElement = document.getElementById('today-words');
        const reviewCountElement = document.getElementById('review-count');
        const displayCountElement = document.getElementById('display-count');
        const totalCountElement = document.getElementById('total-count');
        
        // Elementi navigazione
        const navLinks = document.querySelectorAll('.nav-link');
        const pageContainers = document.querySelectorAll('.page-container');
        
        // Elementi audio
        const uploadArea = document.getElementById('upload-area');
        const audioTitleInput = document.getElementById('audio-title');
        const audioDescriptionInput = document.getElementById('audio-description');
        const audioCategoryInput = document.getElementById('audio-category');
        const uploadAudioBtn = document.getElementById('upload-audio-btn');
        const uploadStatus = document.getElementById('upload-status');
        const fileInfo = document.getElementById('file-info');
        const audioList = document.getElementById('audio-list');
        const audioSearch = document.getElementById('audio-search');
        const audioDisplayCount = document.getElementById('audio-display-count');
        const audioTotalCount = document.getElementById('audio-total-count');
        const playBtn = document.getElementById('play-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = document.getElementById('progress-container');
        const currentTimeElement = document.getElementById('current-time');
        const durationElement = document.getElementById('duration');
        const audioElement = document.getElementById('audio-element');
        const currentAudioTitle = document.getElementById('current-audio-title');
        
        // Elementi disegno
        const drawingCanvas = document.getElementById('drawing-canvas');
        const ctx = drawingCanvas.getContext('2d');
        const toolButtons = document.querySelectorAll('.tool-btn');
        const colorOptions = document.querySelectorAll('.color-option');
        const brushSizeInput = document.getElementById('brush-size');
        const brushSizeValue = document.getElementById('brush-size-value');
        const drawingTitleInput = document.getElementById('drawing-title');
        const drawingDescriptionInput = document.getElementById('drawing-description');
        const saveDrawingBtn = document.getElementById('save-drawing-btn');
        const drawingsList = document.getElementById('drawings-list');
        
        // Elementi note
        const noteTitleInput = document.getElementById('note-title');
        const noteContentInput = document.getElementById('note-content');
        const saveNoteBtn = document.getElementById('save-note-btn');
        const notesList = document.getElementById('notes-list');
        
        // Elementi calendario
        const eventTitleInput = document.getElementById('event-title');
        const eventDateInput = document.getElementById('event-date');
        const eventTimeInput = document.getElementById('event-time');
        const eventDescriptionInput = document.getElementById('event-description');
        const eventTypeInput = document.getElementById('event-type');
        const addEventBtn = document.getElementById('add-event-btn');
        const eventsList = document.getElementById('events-list');
        const eventSearch = document.getElementById('event-search');
        const totalEventsElement = document.getElementById('total-events');
        const upcomingEventsElement = document.getElementById('upcoming-events');
        const eventsDisplayCount = document.getElementById('events-display-count');
        
        // Elementi categorie
        const wordCategorySelect = document.getElementById('word-category');
        const manageCategoriesBtn = document.getElementById('manage-categories-btn');
        const categoryForm = document.getElementById('category-form');
        const newCategoryNameInput = document.getElementById('new-category-name');
        const newCategoryColorInput = document.getElementById('new-category-color');
        const addCategoryBtn = document.getElementById('add-category-btn');
        const categoriesList = document.getElementById('categories-list');
        const categoryFilterButtons = document.getElementById('category-filter-buttons');
        
        // Elementi statistiche
        const statsTotalWords = document.getElementById('stats-total-words');
        const statsTodayWords = document.getElementById('stats-today-words');
        const statsReviewWords = document.getElementById('stats-review-words');
        const statsFavoriteWords = document.getElementById('stats-favorite-words');
        const statsAudioCount = document.getElementById('stats-audio-count');
        const statsDrawingsCount = document.getElementById('stats-drawings-count');
        const statsNotesCount = document.getElementById('stats-notes-count');
        const statsEventsCount = document.getElementById('stats-events-count');
        const recentActivity = document.getElementById('recent-activity');
        
        // Elementi quiz
        const generateQuizBtn = document.getElementById('generate-quiz-btn');
        const resetQuizBtn = document.getElementById('reset-quiz-btn');
        const quizWordList = document.getElementById('quiz-word-list');
        const quizDirection = document.getElementById('quiz-direction');
        const quizNumQuestions = document.getElementById('quiz-num-questions');
        const quizNumChoices = document.getElementById('quiz-num-choices');
        const quizCategoryFilter = document.getElementById('quiz-category-filter');
        const quizQuestionsContainer = document.getElementById('quiz-questions-container');
        const quizStats = document.getElementById('quiz-stats');
        const quizStatsText = document.getElementById('quiz-stats-text');
        const quizResults = document.getElementById('quiz-results');
        
        // Inizializza il canvas
        function initCanvas() {
            // Imposta sfondo bianco
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, drawingCanvas.width, drawingCanvas.height);
            
            // Imposta stili iniziali
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = brushSize;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
        }
        
        // Inizializza la data di oggi nel campo data evento
        function initEventDate() {
            const today = new Date().toISOString().split('T')[0];
            eventDateInput.value = today;
            eventDateInput.min = today;
        }
        
        // Carica i dati all'avvio
        document.addEventListener('DOMContentLoaded', function() {
            initCanvas();
            initEventDate();
            
            // Carica tutti i dati
            loadWords();
            loadAudios();
            loadDrawings();
            loadNotes();
            loadEvents();
            loadCategories();
            
            // Aggiorna le visualizzazioni
            updateStats();
            updateEventStats();
            renderWords();
            renderAudios();
            renderDrawings();
            renderNotes();
            renderEvents();
            updateCategorySelect();
            updateCategoryFilters();
            updateStatistics();
            
            // Inizializza il quiz
            initQuiz();
            
            // Aggiungi dati di esempio se non ce ne sono
            if (words.length === 0) {
                addExampleWords();
            }
            
            if (audios.length === 0) {
                addExampleAudios();
            }
            
            if (notes.length === 0) {
                addExampleNotes();
            }
            
            if (drawings.length === 0) {
                addExampleDrawings();
            }
            
            if (events.length === 0) {
                addExampleEvents();
            }
            
            if (categories.length === 0) {
                addExampleCategories();
            }
            
            // Inizializza i grafici
            setTimeout(() => {
                initCharts();
            }, 100);
        });
        
        // ========== NAVIGAZIONE ==========
        
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                const page = this.getAttribute('data-page');
                
                // Aggiorna link attivo
                navLinks.forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // Mostra la pagina corretta
                pageContainers.forEach(container => {
                    container.classList.remove('active');
                });
                
                document.getElementById(`${page}-page`).classList.add('active');
                
                // Se siamo nella pagina statistiche, aggiorna i grafici
                if (page === 'stats') {
                    updateStatistics();
                    updateCharts();
                }
                // Se siamo nella pagina quiz, aggiorna i dati
                else if (page === 'quiz') {
                    updateQuizWordCount();
                    updateQuizCategoryFilter();
                }
            });
        });
        
        // ========== INIZIALIZZAZIONE QUIZ ==========
        
        function initQuiz() {
            // Aggiorna conteggio parole Workspace
            updateQuizWordCount();
            updateQuizCategoryFilter();
            
            // Setup event listeners per il quiz
            setupQuizEventListeners();
        }
        
        function setupQuizEventListeners() {
            // Pulsanti selezione sorgente
            document.querySelectorAll('[data-quiz-source]').forEach(btn => {
                btn.addEventListener('click', function() {
                    currentQuizSource = this.getAttribute('data-quiz-source');
                    
                    document.querySelectorAll('[data-quiz-source]').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    document.getElementById('quiz-manual-input').style.display = 
                        currentQuizSource === 'manual' ? 'block' : 'none';
                    document.getElementById('quiz-workspace-info').style.display = 
                        currentQuizSource === 'workspace' ? 'block' : 'none';
                });
            });
            
            // Pulsante genera quiz
            generateQuizBtn.addEventListener('click', generateQuiz);
            
            // Pulsante reset quiz
            resetQuizBtn.addEventListener('click', resetQuiz);
        }
        
        function generateQuiz() {
            let vocabulary = [];
            
            if (currentQuizSource === 'manual') {
                // Parsing parole manuali
                const manualWords = parseManualWords();
                if (manualWords.length === 0) {
                    showUploadStatus('Inserisci almeno una parola nel formato corretto (pinyin - traduzione)', 'error');
                    return;
                }
                vocabulary = manualWords;
            } else {
                // Prendi parole da Workspace
                const categoryFilter = quizCategoryFilter.value;
                vocabulary = getWorkspaceWords(categoryFilter);
                
                if (vocabulary.length === 0) {
                    showUploadStatus('Non ci sono parole nel tuo Workspace o nella categoria selezionata. Aggiungi prima delle parole!', 'error');
                    return;
                }
            }
            
            const direction = quizDirection.value;
            const numQuestions = parseInt(quizNumQuestions.value);
            const numChoices = parseInt(quizNumChoices.value);
            
            // Limita il numero di domande al massimo del vocabolario disponibile
            const maxQuestions = Math.min(numQuestions, vocabulary.length);
            
            // Seleziona le parole per le domande in modo casuale
            const selectedWords = [...vocabulary].sort(() => 0.5 - Math.random()).slice(0, maxQuestions);
            
            quizQuestions = [];
            
            // Genera le domande in base alla direzione scelta
            if (direction === 'pinyin-to-italian' || direction === 'both') {
                selectedWords.forEach(word => {
                    const question = createPinyinToItalianQuestion(word, vocabulary, numChoices);
                    quizQuestions.push(question);
                });
            }
            
            if (direction === 'italian-to-pinyin' || direction === 'both') {
                selectedWords.forEach(word => {
                    const question = createItalianToPinyinQuestion(word, vocabulary, numChoices);
                    quizQuestions.push(question);
                });
            }
            
            // Se abbiamo selezionato "entrambe", potremmo avere il doppio delle domande
            // Quindi mescoliamo e prendiamo il numero richiesto
            if (direction === 'both') {
                quizQuestions = quizQuestions.sort(() => 0.5 - Math.random()).slice(0, numQuestions);
            }
            
            // Mescola le domande
            quizQuestions = quizQuestions.sort(() => 0.5 - Math.random());
            
            // Resetta il punteggio
            quizScore = { correct: 0, total: quizQuestions.length };
            
            // Mostra le domande
            renderQuizQuestions();
            
            // Mostra le statistiche
            quizStats.style.display = 'flex';
            
            // Scrolla fino alle domande
            quizQuestionsContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        function parseManualWords() {
            const text = quizWordList.value.trim();
            const lines = text.split('\n');
            const vocabulary = [];
            
            lines.forEach(line => {
                line = line.trim();
                if (line && line.includes('-')) {
                    const parts = line.split('-').map(part => part.trim());
                    if (parts.length >= 2) {
                        vocabulary.push({
                            pinyin: parts[0],
                            italian: parts[1],
                            chinese: '' // Non abbiamo il carattere cinese per le parole manuali
                        });
                    }
                }
            });
            
            return vocabulary;
        }
        
        function getWorkspaceWords(categoryFilter = 'all') {
            let filteredWords = words;
            
            if (categoryFilter !== 'all') {
                filteredWords = filteredWords.filter(word => word.category === categoryFilter);
            }
            
            // Converti formato Workspace a formato quiz
            return filteredWords.map(word => ({
                chinese: word.chinese,
                pinyin: word.pinyin,
                italian: word.translation,
                category: word.category
            }));
        }
        
        function createPinyinToItalianQuestion(correctWord, vocabulary, numChoices) {
            // Seleziona risposte sbagliate casuali
            const wrongChoices = vocabulary
                .filter(word => word.italian !== correctWord.italian)
                .sort(() => 0.5 - Math.random())
                .slice(0, numChoices - 1)
                .map(word => word.italian);
            
            // Crea l'array di tutte le scelte
            const choices = [...wrongChoices, correctWord.italian];
            
            // Mescola le scelte
            const shuffledChoices = choices.sort(() => 0.5 - Math.random());
            
            return {
                type: 'pinyin-to-italian',
                question: `Qual è la traduzione italiana di "<strong>${correctWord.pinyin}</strong>"${correctWord.chinese ? ` (${correctWord.chinese})` : ''}?`,
                correctAnswer: correctWord.italian,
                choices: shuffledChoices,
                userAnswer: null,
                isCorrect: null,
                showFeedback: false
            };
        }
        
        function createItalianToPinyinQuestion(correctWord, vocabulary, numChoices) {
            // Seleziona risposte sbagliate casuali
            const wrongChoices = vocabulary
                .filter(word => word.pinyin !== correctWord.pinyin)
                .sort(() => 0.5 - Math.random())
                .slice(0, numChoices - 1)
                .map(word => word.pinyin);
            
            // Crea l'array di tutte le scelte
            const choices = [...wrongChoices, correctWord.pinyin];
            
            // Mescola le scelte
            const shuffledChoices = choices.sort(() => 0.5 - Math.random());
            
            return {
                type: 'italian-to-pinyin',
                question: `Qual è il pinyin di "<strong>${correctWord.italian}</strong>"${correctWord.chinese ? ` (${correctWord.chinese})` : ''}?`,
                correctAnswer: correctWord.pinyin,
                choices: shuffledChoices,
                userAnswer: null,
                isCorrect: null,
                showFeedback: false
            };
        }
        
        function renderQuizQuestions() {
            if (quizQuestions.length === 0) {
                quizQuestionsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-question"></i>
                        <h3>Nessun quiz generato</h3>
                        <p>Configura le impostazioni e clicca "Genera Quiz" per iniziare!</p>
                    </div>
                `;
                return;
            }
            
            let questionsHTML = '';
            
            quizQuestions.forEach((question, index) => {
                const typeLabel = question.type === 'pinyin-to-italian' ? 'Pinyin → Italiano' : 'Italiano → Pinyin';
                
                questionsHTML += `
                    <div class="quiz-question" data-index="${index}">
                        <div class="quiz-question-header">
                            <div class="quiz-question-number">Domanda ${index + 1}</div>
                            <div class="quiz-question-type">${typeLabel}</div>
                        </div>
                        <div class="quiz-question-text">${question.question}</div>
                        <div class="quiz-answers">
                `;
                
                question.choices.forEach(choice => {
                    let answerClass = 'quiz-answer';
                    let isUserAnswer = question.userAnswer === choice;
                    let isCorrectAnswer = choice === question.correctAnswer;
                    
                    if (question.userAnswer !== null) {
                        // L'utente ha già risposto
                        if (isUserAnswer && question.isCorrect) {
                            answerClass += ' correct';
                        } else if (isUserAnswer && !question.isCorrect) {
                            answerClass += ' incorrect';
                        } else if (isCorrectAnswer && !question.isCorrect) {
                            // Mostra la risposta corretta se l'utente ha sbagliato
                            answerClass += ' correct';
                        } else {
                            answerClass += ' disabled';
                        }
                    }
                    
                    questionsHTML += `
                        <div class="${answerClass}" data-question-index="${index}" data-choice="${choice}">
                            ${choice}
                        </div>
                    `;
                });
                
                questionsHTML += `</div>`;
                
                // Aggiungi feedback per risposta sbagliata
                if (question.userAnswer !== null && !question.isCorrect && question.showFeedback) {
                    questionsHTML += `
                        <div class="quiz-feedback show">
                            <span>Risposta corretta: <strong>${question.correctAnswer}</strong></span>
                            <br><small>Hai selezionato: ${question.userAnswer}</small>
                        </div>
                    `;
                }
                
                questionsHTML += `</div>`;
            });
            
            quizQuestionsContainer.innerHTML = questionsHTML;
            
            // Aggiungi event listener per le risposte
            document.querySelectorAll('.quiz-answer:not(.disabled)').forEach(answer => {
                answer.addEventListener('click', function() {
                    const questionIndex = parseInt(this.getAttribute('data-question-index'));
                    const selectedChoice = this.getAttribute('data-choice');
                    answerQuizQuestion(questionIndex, selectedChoice);
                });
            });
            
            updateQuizStats();
        }
        
        function answerQuizQuestion(questionIndex, selectedChoice) {
            const question = quizQuestions[questionIndex];
            
            // Se l'utente ha già risposto, non fare nulla
            if (question.userAnswer !== null) {
                return;
            }
            
            question.userAnswer = selectedChoice;
            question.isCorrect = (selectedChoice === question.correctAnswer);
            question.showFeedback = !question.isCorrect; // Mostra feedback solo se sbagliata
            
            if (question.isCorrect) {
                quizScore.correct++;
            }
            
            updateQuizStats();
            renderQuizQuestions();
            
            // Controlla se tutte le domande sono state risposte
            const allAnswered = quizQuestions.every(q => q.userAnswer !== null);
            if (allAnswered) {
                showQuizResults();
            }
        }
        
        function updateQuizStats() {
            const answered = quizQuestions.filter(q => q.userAnswer !== null).length;
            quizStatsText.textContent = 
                `Domande: ${quizQuestions.length} | Risposte: ${answered} | Corrette: ${quizScore.correct} | Sbagliate: ${answered - quizScore.correct}`;
        }
        
        function showQuizResults() {
            const percentage = Math.round((quizScore.correct / quizScore.total) * 100);
            
            let message = '';
            if (percentage === 100) {
                message = `🎉 Perfetto! ${quizScore.correct}/${quizScore.total} (${percentage}%) - Sei un genio del cinese!`;
            } else if (percentage >= 80) {
                message = `👍 Ottimo lavoro! ${quizScore.correct}/${quizScore.total} (${percentage}%) - Stai facendo grandi progressi!`;
            } else if (percentage >= 60) {
                message = `😊 Non male! ${quizScore.correct}/${quizScore.total} (${percentage}%) - Continua così!`;
            } else {
                message = `📚 Da ripassare: ${quizScore.correct}/${quizScore.total} (${percentage}%) - Ripeti le parole sbagliate!`;
            }
            
            quizResults.textContent = message;
            quizResults.className = 'quiz-results show';
            
            // Mostra tutte le risposte corrette per le domande sbagliate
            quizQuestions.forEach(question => {
                if (!question.isCorrect) {
                    question.showFeedback = true;
                }
            });
            renderQuizQuestions();
        }
        
        function resetQuiz() {
            quizQuestions.forEach(question => {
                question.userAnswer = null;
                question.isCorrect = null;
                question.showFeedback = false;
            });
            
            quizScore = { correct: 0, total: quizQuestions.length };
            quizResults.className = 'quiz-results';
            renderQuizQuestions();
        }
        
        function updateQuizWordCount() {
            const workspaceWordCount = document.getElementById('workspace-word-count');
            const quizTotalWords = document.getElementById('quiz-total-words');
            
            if (workspaceWordCount) workspaceWordCount.textContent = words.length;
            if (quizTotalWords) quizTotalWords.textContent = words.length;
        }
        
        function updateQuizCategoryFilter() {
            // Svuota il select
            quizCategoryFilter.innerHTML = '<option value="all">Tutte le categorie</option>';
            
            // Aggiungi tutte le categorie
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.name;
                option.textContent = category.name.charAt(0).toUpperCase() + category.name.slice(1);
                quizCategoryFilter.appendChild(option);
            });
        }
        
        // ========== GESTIONE CALENDARIO ==========
        
        addEventBtn.addEventListener('click', function() {
            const title = eventTitleInput.value.trim();
            const date = eventDateInput.value;
            const time = eventTimeInput.value;
            const description = eventDescriptionInput.value.trim();
            const type = eventTypeInput.value;
            
            if (!title || !date) {
                showUploadStatus('Inserisci almeno titolo e data per l\'evento.', 'error');
                return;
            }
            
            const newEvent = {
                id: Date.now(),
                title: title,
                date: date,
                time: time || '',
                description: description,
                type: type,
                createdAt: new Date().toISOString()
            };
            
            events.unshift(newEvent);
            saveEvents();
            renderEvents();
            updateEventStats();
            
            // Reset form
            eventTitleInput.value = '';
            eventTimeInput.value = '';
            eventDescriptionInput.value = '';
            eventTypeInput.value = 'lezione';
            initEventDate();
            
            showUploadStatus('Evento aggiunto al calendario!', 'success');
        });
        
        function loadEvents() {
            const savedEvents = localStorage.getItem('chineseEvents');
            if (savedEvents) {
                events = JSON.parse(savedEvents);
            }
        }
        
        function saveEvents() {
            localStorage.setItem('chineseEvents', JSON.stringify(events));
        }
        
        function renderEvents() {
            let filteredEvents = events;
            
            // Applica filtro
            if (currentEventFilter === 'upcoming') {
                const today = new Date();
                const nextWeek = new Date();
                nextWeek.setDate(today.getDate() + 7);
                
                filteredEvents = filteredEvents.filter(event => {
                    const eventDate = new Date(event.date);
                    return eventDate >= today && eventDate <= nextWeek;
                });
            } else if (currentEventFilter !== 'all') {
                filteredEvents = filteredEvents.filter(event => event.type === currentEventFilter);
            }
            
            // Applica ricerca
            if (eventSearchQuery) {
                const query = eventSearchQuery.toLowerCase();
                filteredEvents = filteredEvents.filter(event => {
                    return event.title.toLowerCase().includes(query) ||
                           event.description.toLowerCase().includes(query);
                });
            }
            
            // Ordina per data (più recenti prima)
            filteredEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            eventsDisplayCount.textContent = filteredEvents.length;
            
            if (filteredEvents.length === 0) {
                eventsList.innerHTML = `
                    <div class="empty-state">
                        <i class="far fa-calendar"></i>
                        <h3>Nessun evento trovato</h3>
                        <p>${events.length === 0 ? 'Aggiungi il tuo primo evento!' : 'Prova a cambiare filtro o ricerca'}</p>
                    </div>
                `;
                return;
            }
            
            let eventsHTML = '';
            filteredEvents.forEach(event => {
                const eventDate = new Date(event.date);
                const formattedDate = eventDate.toLocaleDateString('it-IT', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const eventDateOnly = new Date(event.date);
                eventDateOnly.setHours(0, 0, 0, 0);
                
                let dateClass = '';
                if (eventDateOnly.getTime() === today.getTime()) {
                    dateClass = 'style="color: var(--success);"';
                } else if (eventDateOnly < today) {
                    dateClass = 'style="color: var(--gray);"';
                }
                
                eventsHTML += `
                    <div class="event-item" data-id="${event.id}">
                        <div class="event-header">
                            <div class="event-title">${event.title}</div>
                            <div class="event-date" ${dateClass}>${formattedDate}</div>
                        </div>
                        ${event.time ? `<div class="event-description"><i class="far fa-clock"></i> ${event.time}</div>` : ''}
                        ${event.description ? `<div class="event-description">${event.description}</div>` : ''}
                        <div class="event-meta">
                            <span>${event.type.charAt(0).toUpperCase() + event.type.slice(1)}</span>
                            <button class="action-btn" onclick="deleteEvent(${event.id})">
                                <i class="fas fa-trash-alt"></i> Elimina
                            </button>
                        </div>
                    </div>
                `;
            });
            
            eventsList.innerHTML = eventsHTML;
        }
        
        function addExampleEvents() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const nextWeek = new Date(today);
            nextWeek.setDate(nextWeek.getDate() + 7);
            
            const exampleEvents = [
                {
                    id: 1,
                    title: 'Lezione di cinese',
                    date: today.toISOString().split('T')[0],
                    time: '18:00',
                    description: 'Ripassare verbi di azione',
                    type: 'lezione',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    title: 'Pratica conversazione',
                    date: tomorrow.toISOString().split('T')[0],
                    time: '20:00',
                    description: 'Incontro con partner linguistico',
                    type: 'incontro',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 3,
                    title: 'Esame HSK 1',
                    date: nextWeek.toISOString().split('T')[0],
                    time: '10:00',
                    description: 'Portare documento di identità',
                    type: 'esame',
                    createdAt: new Date().toISOString()
                }
            ];
            
            events = exampleEvents;
            saveEvents();
        }
        
        function updateEventStats() {
            totalEventsElement.textContent = events.length;
            
            // Conta eventi nei prossimi 7 giorni
            const today = new Date();
            const nextWeek = new Date();
            nextWeek.setDate(today.getDate() + 7);
            
            const upcomingEvents = events.filter(event => {
                const eventDate = new Date(event.date);
                return eventDate >= today && eventDate <= nextWeek;
            }).length;
            
            upcomingEventsElement.textContent = upcomingEvents;
        }
        
        function deleteEvent(id) {
            if (confirm('Eliminare questo evento?')) {
                events = events.filter(event => event.id !== id);
                saveEvents();
                renderEvents();
                updateEventStats();
            }
        }
        
        eventSearch.addEventListener('input', function() {
            eventSearchQuery = this.value;
            renderEvents();
        });
        
        document.querySelectorAll('[data-event-filter]').forEach(button => {
            button.addEventListener('click', function() {
                currentEventFilter = this.getAttribute('data-event-filter');
                
                document.querySelectorAll('[data-event-filter]').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                renderEvents();
            });
        });
        
        // ========== GESTIONE PAROLE ==========
        
        addWordBtn.addEventListener('click', function() {
            const chineseWord = chineseWordInput.value.trim();
            const pinyin = pinyinInput.value.trim();
            const translation = translationInput.value.trim();
            const category = wordCategorySelect.value;
            
            if (!chineseWord || !pinyin || !translation) {
                showUploadStatus('Inserisci almeno la parola cinese, il pinyin e la traduzione.', 'error');
                return;
            }
            
            const newWord = {
                id: Date.now(),
                chinese: chineseWord,
                pinyin: pinyin,
                translation: translation,
                category: category,
                associations: associationsInput.value.trim(),
                example: exampleInput.value.trim(),
                dateAdded: new Date().toISOString().split('T')[0],
                lastReviewed: null,
                needsReview: true,
                favorite: false
            };
            
            words.unshift(newWord);
            saveWords();
            renderWords();
            updateStats();
            updateStatistics();
            updateCharts();
            updateQuizWordCount();
            clearForm();
            
            // Feedback visivo
            addWordBtn.innerHTML = '<i class="fas fa-check"></i> Aggiunta!';
            addWordBtn.style.backgroundColor = 'var(--success)';
            
            setTimeout(() => {
                addWordBtn.innerHTML = '<i class="fas fa-save"></i> Salva Parola';
                addWordBtn.style.backgroundColor = '';
            }, 1500);
        });
        
        function loadWords() {
            const savedWords = localStorage.getItem('chineseWords');
            if (savedWords) {
                words = JSON.parse(savedWords);
            }
        }
        
        function saveWords() {
            localStorage.setItem('chineseWords', JSON.stringify(words));
        }
        
        function clearForm() {
            chineseWordInput.value = '';
            pinyinInput.value = '';
            translationInput.value = '';
            associationsInput.value = '';
            exampleInput.value = '';
            wordCategorySelect.value = 'generale';
            chineseWordInput.focus();
        }
        
        function renderWords() {
            let filteredWords = words;
            
            if (currentFilter === 'recent') {
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                filteredWords = filteredWords.filter(word => {
                    const wordDate = new Date(word.dateAdded);
                    return wordDate >= oneWeekAgo;
                });
            } else if (currentFilter === 'review') {
                filteredWords = filteredWords.filter(word => word.needsReview);
            } else if (currentFilter === 'favorite') {
                filteredWords = filteredWords.filter(word => word.favorite);
            } else if (currentFilter === 'category' && selectedCategoryFilter) {
                filteredWords = filteredWords.filter(word => word.category === selectedCategoryFilter);
            }
            
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filteredWords = filteredWords.filter(word => {
                    return word.chinese.toLowerCase().includes(query) ||
                           word.pinyin.toLowerCase().includes(query) ||
                           word.translation.toLowerCase().includes(query);
                });
            }
            
            displayCountElement.textContent = filteredWords.length;
            totalCountElement.textContent = words.length;
            
            if (filteredWords.length === 0) {
                wordsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="far fa-file-alt"></i>
                        <h3>Nessuna parola trovata</h3>
                        <p>${words.length === 0 ? 'Aggiungi la tua prima parola!' : 'Prova a cambiare filtro o ricerca'}</p>
                    </div>
                `;
                return;
            }
            
            let wordsHTML = '';
            filteredWords.forEach(word => {
                const category = categories.find(c => c.name === word.category);
                const categoryColor = category ? category.color : '#4caf50';
                
                wordsHTML += `
                    <div class="word-card" data-id="${word.id}">
                        <div class="word-header">
                            <h3 class="character-display">${word.chinese}</h3>
                            <div>
                                <span class="word-category" style="background-color: ${categoryColor}20; color: ${categoryColor};">${word.category}</span>
                                <button class="action-btn ${word.favorite ? 'favorite' : ''}" onclick="toggleFavorite(${word.id})">
                                    <i class="${word.favorite ? 'fas' : 'far'} fa-star"></i>
                                </button>
                            </div>
                        </div>
                        <div class="pinyin">${word.pinyin}</div>
                        <div class="translation">${word.translation}</div>
                        
                        ${word.associations ? `
                            <div class="section-title"><i class="fas fa-brain"></i> Associazioni</div>
                            <div class="associations">${word.associations}</div>
                        ` : ''}
                        
                        ${word.example ? `
                            <div class="section-title"><i class="fas fa-comment"></i> Esempio</div>
                            <div class="example-sentence">${word.example}</div>
                        ` : ''}
                        
                        <div class="word-actions">
                            <button class="action-btn" onclick="markAsReviewed(${word.id})">
                                <i class="fas fa-check-circle"></i> Ripassata
                            </button>
                            <button class="action-btn" onclick="deleteWord(${word.id})">
                                <i class="fas fa-trash-alt"></i> Elimina
                            </button>
                        </div>
                    </div>
                `;
            });
            
            wordsContainer.innerHTML = wordsHTML;
        }
        
        function addExampleWords() {
            const exampleWords = [
                {
                    id: 1,
                    chinese: '你好',
                    pinyin: 'nǐ hǎo',
                    translation: 'Ciao',
                    category: 'saluti',
                    associations: '你 (nǐ) sembra una persona che si inchina',
                    example: '你好，我叫玛丽。 (nǐ hǎo, wǒ jiào mǎlì) - Ciao, mi chiamo Maria.',
                    dateAdded: new Date().toISOString().split('T')[0],
                    lastReviewed: null,
                    needsReview: true,
                    favorite: true
                },
                {
                    id: 2,
                    chinese: '谢谢',
                    pinyin: 'xiè xie',
                    translation: 'Grazie',
                    category: 'saluti',
                    associations: '谢 (xiè) sembra una persona che ringrazia',
                    example: '谢谢你的帮助。 (xièxie nǐ de bāngzhù) - Grazie per il tuo aiuto.',
                    dateAdded: new Date().toISOString().split('T')[0],
                    lastReviewed: null,
                    needsReview: true,
                    favorite: true
                },
                {
                    id: 3,
                    chinese: '爱',
                    pinyin: 'ài',
                    translation: 'Amore',
                    category: 'emozioni',
                    associations: 'Sembra una persona che abbraccia un cuore',
                    example: '我爱你。 (wǒ ài nǐ) - Ti amo.',
                    dateAdded: '2023-10-03',
                    lastReviewed: '2023-10-10',
                    needsReview: false,
                    favorite: false
                },
                {
                    id: 4,
                    chinese: '水',
                    pinyin: 'shuǐ',
                    translation: 'Acqua',
                    category: 'elementi',
                    associations: 'Sembra le onde dell\'acqua',
                    example: '我想要一杯水。 (wǒ xiǎng yào yī bēi shuǐ) - Vorrei un bicchiere d\'acqua.',
                    dateAdded: '2023-10-04',
                    lastReviewed: null,
                    needsReview: true,
                    favorite: false
                }
            ];
            
            words = exampleWords;
            saveWords();
            updateStats();
        }
        
        function updateStats() {
            totalWordsElement.textContent = words.length;
            
            const today = new Date().toISOString().split('T')[0];
            const todayWords = words.filter(word => word.dateAdded === today).length;
            todayWordsElement.textContent = todayWords;
            
            const reviewWords = words.filter(word => word.needsReview).length;
            reviewCountElement.textContent = reviewWords;
        }
        
        function markAsReviewed(id) {
            const wordIndex = words.findIndex(word => word.id === id);
            if (wordIndex !== -1) {
                words[wordIndex].needsReview = false;
                words[wordIndex].lastReviewed = new Date().toISOString().split('T')[0];
                saveWords();
                renderWords();
                updateStats();
                updateStatistics();
            }
        }
        
        function deleteWord(id) {
            if (confirm('Eliminare questa parola?')) {
                words = words.filter(word => word.id !== id);
                saveWords();
                renderWords();
                updateStats();
                updateStatistics();
                updateCharts();
                updateQuizWordCount();
            }
        }
        
        function toggleFavorite(id) {
            const wordIndex = words.findIndex(word => word.id === id);
            if (wordIndex !== -1) {
                words[wordIndex].favorite = !words[wordIndex].favorite;
                saveWords();
                renderWords();
                updateStatistics();
            }
        }
        
        searchInput.addEventListener('input', function() {
            searchQuery = this.value;
            renderWords();
        });
        
        document.querySelectorAll('[data-filter]').forEach(button => {
            button.addEventListener('click', function() {
                currentFilter = this.getAttribute('data-filter');
                selectedCategoryFilter = '';
                
                document.querySelectorAll('[data-filter]').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                // Mostra/nascondi filtri categoria
                if (currentFilter === 'category') {
                    categoryFilterButtons.style.display = 'flex';
                } else {
                    categoryFilterButtons.style.display = 'none';
                }
                
                renderWords();
            });
        });
        
        // ========== GESTIONE CATEGORIE ==========
        
        manageCategoriesBtn.addEventListener('click', function() {
            categoryForm.style.display = categoryForm.style.display === 'none' ? 'block' : 'none';
            if (categoryForm.style.display === 'block') {
                renderCategoriesList();
            }
        });
        
        addCategoryBtn.addEventListener('click', function() {
            const name = newCategoryNameInput.value.trim();
            const color = newCategoryColorInput.value;
            
            if (!name) {
                showUploadStatus('Inserisci un nome per la categoria.', 'error');
                return;
            }
            
            // Controlla se la categoria esiste già
            if (categories.find(c => c.name.toLowerCase() === name.toLowerCase())) {
                showUploadStatus('Questa categoria esiste già!', 'error');
                return;
            }
            
            const newCategory = {
                id: Date.now(),
                name: name,
                color: color
            };
            
            categories.push(newCategory);
            saveCategories();
            updateCategorySelect();
            updateCategoryFilters();
            updateQuizCategoryFilter();
            renderCategoriesList();
            
            // Reset form
            newCategoryNameInput.value = '';
            
            showUploadStatus('Categoria aggiunta!', 'success');
        });
        
        function loadCategories() {
            const savedCategories = localStorage.getItem('chineseCategories');
            if (savedCategories) {
                categories = JSON.parse(savedCategories);
            }
        }
        
        function saveCategories() {
            localStorage.setItem('chineseCategories', JSON.stringify(categories));
        }
        
        function addExampleCategories() {
            const exampleCategories = [
                { id: 1, name: 'generale', color: '#4caf50' },
                { id: 2, name: 'saluti', color: '#2196f3' },
                { id: 3, name: 'emozioni', color: '#9c27b0' },
                { id: 4, name: 'elementi', color: '#ff9800' },
                { id: 5, name: 'famiglia', color: '#f44336' },
                { id: 6, name: 'cibo', color: '#009688' }
            ];
            
            categories = exampleCategories;
            saveCategories();
        }
        
        function updateCategorySelect() {
            // Svuota il select
            wordCategorySelect.innerHTML = '<option value="generale">Generale</option>';
            
            // Aggiungi tutte le categorie
            categories.forEach(category => {
                if (category.name !== 'generale') {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = category.name.charAt(0).toUpperCase() + category.name.slice(1);
                    wordCategorySelect.appendChild(option);
                }
            });
        }
        
        function updateCategoryFilters() {
            categoryFilterButtons.innerHTML = '';
            
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'filter-btn category-filter-btn';
                button.setAttribute('data-category', category.name);
                button.innerHTML = `<i class="fas fa-tag"></i> ${category.name}`;
                button.style.backgroundColor = category.color + '20';
                button.style.color = category.color;
                button.style.borderColor = category.color;
                
                button.addEventListener('click', function() {
                    selectedCategoryFilter = category.name;
                    
                    // Aggiorna stato attivo
                    document.querySelectorAll('.category-filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                        btn.style.backgroundColor = btn.getAttribute('data-category') === category.name ? category.color : category.color + '20';
                        btn.style.color = btn.getAttribute('data-category') === category.name ? 'white' : category.color;
                    });
                    
                    this.classList.add('active');
                    this.style.backgroundColor = category.color;
                    this.style.color = 'white';
                    
                    renderWords();
                });
                
                categoryFilterButtons.appendChild(button);
            });
        }
        
        function renderCategoriesList() {
            categoriesList.innerHTML = '';
            
            categories.forEach(category => {
                if (category.name === 'generale') return;
                
                const categoryItem = document.createElement('div');
                categoryItem.className = 'category-item';
                categoryItem.innerHTML = `
                    <span class="category-color" style="background-color: ${category.color};"></span>
                    <span>${category.name}</span>
                    <button class="remove-category" onclick="removeCategory('${category.name}')">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                categoriesList.appendChild(categoryItem);
            });
        }
        
        function removeCategory(categoryName) {
            if (categoryName === 'generale') {
                showUploadStatus('Non puoi eliminare la categoria generale.', 'error');
                return;
            }
            
            if (confirm(`Eliminare la categoria "${categoryName}"? Le parole in questa categoria verranno spostate in "generale".`)) {
                // Sposta le parole alla categoria generale
                words.forEach(word => {
                    if (word.category === categoryName) {
                        word.category = 'generale';
                    }
                });
                
                // Rimuovi la categoria
                categories = categories.filter(c => c.name !== categoryName);
                
                saveWords();
                saveCategories();
                updateCategorySelect();
                updateCategoryFilters();
                updateQuizCategoryFilter();
                renderCategoriesList();
                renderWords();
                
                showUploadStatus('Categoria eliminata!', 'success');
            }
        }
        
        // ========== GESTIONE AUDIO ==========
        
        uploadArea.addEventListener('click', function() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'audio/*';
            fileInput.multiple = false;
            
            fileInput.addEventListener('change', function(e) {
                if (this.files.length > 0) {
                    selectedAudioFile = this.files[0];
                    
                    if (selectedAudioFile.size > 5 * 1024 * 1024) {
                        showUploadStatus('File troppo grande! Massimo 5MB.', 'error');
                        selectedAudioFile = null;
                        fileInfo.textContent = 'Nessun file selezionato';
                        return;
                    }
                    
                    fileInfo.textContent = `${selectedAudioFile.name} (${(selectedAudioFile.size / 1024 / 1024).toFixed(2)} MB)`;
                    audioTitleInput.value = selectedAudioFile.name.replace(/\.[^/.]+$/, "");
                    
                    showUploadStatus('File selezionato. Compila i dettagli e clicca "Carica Audio".', 'success');
                }
            });
            
            fileInput.click();
        });
        
        uploadAudioBtn.addEventListener('click', function() {
            if (!selectedAudioFile) {
                showUploadStatus('Seleziona un file audio prima!', 'error');
                return;
            }
            
            const title = audioTitleInput.value.trim();
            if (!title) {
                showUploadStatus('Inserisci un titolo per l\'audio.', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const newAudio = {
                    id: Date.now(),
                    title: title,
                    description: audioDescriptionInput.value.trim(),
                    category: audioCategoryInput.value,
                    fileName: selectedAudioFile.name,
                    fileSize: selectedAudioFile.size,
                    fileType: selectedAudioFile.type,
                    audioUrl: e.target.result,
                    uploadedAt: new Date().toISOString()
                };
                
                audios.unshift(newAudio);
                saveAudios();
                renderAudios();
                updateStatistics();
                
                resetAudioForm();
                showUploadStatus('Audio salvato correttamente!', 'success');
            };
            
            reader.readAsDataURL(selectedAudioFile);
        });
        
        function loadAudios() {
            const savedAudios = localStorage.getItem('chineseAudios');
            if (savedAudios) {
                audios = JSON.parse(savedAudios);
            }
        }
        
        function saveAudios() {
            localStorage.setItem('chineseAudios', JSON.stringify(audios));
        }
        
        function renderAudios() {
            let filteredAudios = audios;
            
            if (currentAudioFilter !== 'all') {
                filteredAudios = filteredAudios.filter(audio => audio.category === currentAudioFilter);
            }
            
            if (audioSearchQuery) {
                const query = audioSearchQuery.toLowerCase();
                filteredAudios = filteredAudios.filter(audio => {
                    return audio.title.toLowerCase().includes(query) ||
                           (audio.description && audio.description.toLowerCase().includes(query));
                });
            }
            
            audioDisplayCount.textContent = filteredAudios.length;
            audioTotalCount.textContent = audios.length;
            
            if (filteredAudios.length === 0) {
                audioList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-music"></i>
                        <h3>Nessun audio trovato</h3>
                        <p>${audios.length === 0 ? 'Carica il tuo primo audio!' : 'Prova a cambiare filtro o ricerca'}</p>
                    </div>
                `;
                return;
            }
            
            let audioHTML = '';
            filteredAudios.forEach(audio => {
                const uploadDate = new Date(audio.uploadedAt).toLocaleDateString('it-IT');
                const fileSizeMB = (audio.fileSize / 1024 / 1024).toFixed(2);
                
                audioHTML += `
                    <div class="audio-item" data-id="${audio.id}">
                        <div class="audio-info">
                            <div class="audio-name">${audio.title}</div>
                            <div class="audio-meta">
                                ${audio.description ? `${audio.description} • ` : ''}
                                ${uploadDate} • ${fileSizeMB} MB
                            </div>
                        </div>
                        <div class="audio-actions">
                            <button class="action-btn" onclick="playAudio('${audio.audioUrl}', '${audio.title}')">
                                <i class="fas fa-play"></i> Ascolta
                            </button>
                            <button class="action-btn" onclick="deleteAudio(${audio.id})">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            audioList.innerHTML = audioHTML;
        }
        
        function addExampleAudios() {
            const exampleAudios = [
                {
                    id: 1,
                    title: 'Pronuncia corretta di 你好',
                    description: 'Come dire "ciao" in cinese',
                    category: 'pronuncia',
                    fileName: 'nihao.mp3',
                    fileSize: 102400,
                    fileType: 'audio/mpeg',
                    audioUrl: '#',
                    uploadedAt: new Date().toISOString()
                }
            ];
            
            audios = exampleAudios;
            saveAudios();
        }
        
        function playAudio(url, title) {
            if (url === '#') {
                showUploadStatus('Questo è un audio di esempio. Carica i tuoi file audio per ascoltarli.', 'error');
                return;
            }
            
            audioElement.src = url;
            currentAudioTitle.textContent = title;
            
            audioElement.play();
            playBtn.innerHTML = '<i class="fas fa-pause"></i>';
            
            audioElement.addEventListener('timeupdate', updateProgress);
            audioElement.addEventListener('loadedmetadata', function() {
                durationElement.textContent = formatTime(audioElement.duration);
            });
            
            audioElement.addEventListener('ended', function() {
                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                progressBar.style.width = '0%';
                currentTimeElement.textContent = '0:00';
            });
        }
        
        function updateProgress() {
            const progressPercent = (audioElement.currentTime / audioElement.duration) * 100;
            progressBar.style.width = `${progressPercent}%`;
            currentTimeElement.textContent = formatTime(audioElement.currentTime);
        }
        
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        playBtn.addEventListener('click', function() {
            if (!audioElement.src || audioElement.src === '') {
                showUploadStatus('Seleziona un audio da riprodurre.', 'error');
                return;
            }
            
            if (audioElement.paused) {
                audioElement.play();
                this.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                audioElement.pause();
                this.innerHTML = '<i class="fas fa-play"></i>';
            }
        });
        
        progressContainer.addEventListener('click', function(e) {
            if (!audioElement.duration) return;
            
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = audioElement.duration;
            
            audioElement.currentTime = (clickX / width) * duration;
        });
        
        function deleteAudio(id) {
            if (confirm('Eliminare questo audio?')) {
                audios = audios.filter(audio => audio.id !== id);
                saveAudios();
                renderAudios();
                updateStatistics();
                
                if (audioElement.src.includes(id)) {
                    audioElement.pause();
                    audioElement.src = '';
                    currentAudioTitle.textContent = 'Nessun audio selezionato';
                    playBtn.innerHTML = '<i class="fas fa-play"></i>';
                    progressBar.style.width = '0%';
                }
            }
        }
        
        audioSearch.addEventListener('input', function() {
            audioSearchQuery = this.value;
            renderAudios();
        });
        
        document.querySelectorAll('[data-audio-filter]').forEach(button => {
            button.addEventListener('click', function() {
                currentAudioFilter = this.getAttribute('data-audio-filter');
                
                document.querySelectorAll('[data-audio-filter]').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                renderAudios();
            });
        });
        
        function showUploadStatus(message, type) {
            uploadStatus.textContent = message;
            uploadStatus.className = 'status-message';
            uploadStatus.classList.add(`status-${type}`);
            
            setTimeout(() => {
                uploadStatus.style.display = 'none';
            }, 3000);
        }
        
        function resetAudioForm() {
            selectedAudioFile = null;
            audioTitleInput.value = '';
            audioDescriptionInput.value = '';
            audioCategoryInput.value = 'pronuncia';
            fileInfo.textContent = 'Nessun file selezionato';
        }
        
        // ========== GESTIONE DISEGNO ==========
        
        toolButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tool = this.getAttribute('data-tool');
                
                if (tool === 'clear') {
                    if (confirm('Cancellare tutto il disegno?')) {
                        initCanvas();
                    }
                    return;
                }
                
                toolButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                currentTool = tool;
                
                if (tool === 'eraser') {
                    ctx.strokeStyle = 'white';
                } else {
                    ctx.strokeStyle = currentColor;
                }
            });
        });
        
        colorOptions.forEach(option => {
            option.addEventListener('click', function() {
                if (currentTool === 'brush') {
                    const color = this.getAttribute('data-color');
                    currentColor = color;
                    ctx.strokeStyle = color;
                    
                    colorOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });
        
        brushSizeInput.addEventListener('input', function() {
            brushSize = parseInt(this.value);
            brushSizeValue.textContent = brushSize + 'px';
            ctx.lineWidth = brushSize;
        });
        
        drawingCanvas.addEventListener('mousedown', startDrawing);
        drawingCanvas.addEventListener('mousemove', draw);
        drawingCanvas.addEventListener('mouseup', stopDrawing);
        drawingCanvas.addEventListener('mouseout', stopDrawing);
        
        drawingCanvas.addEventListener('touchstart', function(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            drawingCanvas.dispatchEvent(mouseEvent);
        });
        
        drawingCanvas.addEventListener('touchmove', function(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            drawingCanvas.dispatchEvent(mouseEvent);
        });
        
        drawingCanvas.addEventListener('touchend', function(e) {
            e.preventDefault();
            const mouseEvent = new MouseEvent('mouseup', {});
            drawingCanvas.dispatchEvent(mouseEvent);
        });
        
        function startDrawing(e) {
            isDrawing = true;
            [lastX, lastY] = getMousePos(e);
        }
        
        function draw(e) {
            if (!isDrawing) return;
            
            e.preventDefault();
            const [x, y] = getMousePos(e);
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();
            
            [lastX, lastY] = [x, y];
        }
        
        function stopDrawing() {
            isDrawing = false;
        }
        
        function getMousePos(e) {
            const rect = drawingCanvas.getBoundingClientRect();
            return [
                e.clientX - rect.left,
                e.clientY - rect.top
            ];
        }
        
        saveDrawingBtn.addEventListener('click', function() {
            const title = drawingTitleInput.value.trim();
            if (!title) {
                showUploadStatus('Inserisci un titolo per il disegno.', 'error');
                return;
            }
            
            const imageData = drawingCanvas.toDataURL('image/png');
            
            const newDrawing = {
                id: Date.now(),
                title: title,
                description: drawingDescriptionInput.value.trim(),
                imageData: imageData,
                createdAt: new Date().toISOString()
            };
            
            drawings.unshift(newDrawing);
            saveDrawings();
            renderDrawings();
            updateStatistics();
            
            drawingTitleInput.value = '';
            drawingDescriptionInput.value = '';
            
            showUploadStatus('Disegno salvato correttamente!', 'success');
        });
        
        function loadDrawings() {
            const savedDrawings = localStorage.getItem('chineseDrawings');
            if (savedDrawings) {
                drawings = JSON.parse(savedDrawings);
            }
        }
        
        function saveDrawings() {
            localStorage.setItem('chineseDrawings', JSON.stringify(drawings));
        }
        
        function renderDrawings() {
            if (drawings.length === 0) {
                drawingsList.innerHTML = `
                    <div class="empty-state">
                        <i class="far fa-image"></i>
                        <h3>Nessun disegno ancora</h3>
                        <p>Crea il tuo primo disegno!</p>
                    </div>
                `;
                return;
            }
            
            let drawingsHTML = '';
            drawings.forEach(drawing => {
                const createDate = new Date(drawing.createdAt).toLocaleDateString('it-IT');
                
                drawingsHTML += `
                    <div class="drawing-item" data-id="${drawing.id}">
                        <div class="drawing-header">
                            <div class="audio-name">${drawing.title}</div>
                            <div class="audio-meta">${createDate}</div>
                        </div>
                        ${drawing.description ? `<p>${drawing.description}</p>` : ''}
                        <div class="drawing-preview">
                            <img src="${drawing.imageData}" alt="${drawing.title}" class="drawing-canvas-preview">
                        </div>
                        <div class="note-actions">
                            <button class="action-btn" onclick="deleteDrawing(${drawing.id})">
                                <i class="fas fa-trash-alt"></i> Elimina
                            </button>
                        </div>
                    </div>
                `;
            });
            
            drawingsList.innerHTML = drawingsHTML;
        }
        
        function addExampleDrawings() {
            const exampleDrawing = {
                id: 1,
                title: 'Pratica di 你',
                description: 'Ordine dei tratti per il carattere 你',
                imageData: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==',
                createdAt: new Date().toISOString()
            };
            
            drawings = [exampleDrawing];
            saveDrawings();
        }
        
        function deleteDrawing(id) {
            if (confirm('Eliminare questo disegno?')) {
                drawings = drawings.filter(drawing => drawing.id !== id);
                saveDrawings();
                renderDrawings();
                updateStatistics();
            }
        }
        
        // ========== GESTIONE NOTE ==========
        
        saveNoteBtn.addEventListener('click', function() {
            const title = noteTitleInput.value.trim();
            const content = noteContentInput.value.trim();
            
            if (!title || !content) {
                showUploadStatus('Inserisci sia titolo che contenuto per la nota.', 'error');
                return;
            }
            
            const newNote = {
                id: Date.now(),
                title: title,
                content: content,
                createdAt: new Date().toISOString()
            };
            
            notes.unshift(newNote);
            saveNotes();
            renderNotes();
            updateStatistics();
            
            noteTitleInput.value = '';
            noteContentInput.value = '';
            
            showUploadStatus('Nota salvata correttamente!', 'success');
        });
        
        function loadNotes() {
            const savedNotes = localStorage.getItem('chineseNotes');
            if (savedNotes) {
                notes = JSON.parse(savedNotes);
            }
        }
        
        function saveNotes() {
            localStorage.setItem('chineseNotes', JSON.stringify(notes));
        }
        
        function renderNotes() {
            if (notes.length === 0) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <i class="far fa-sticky-note"></i>
                        <h3>Nessuna nota ancora</h3>
                        <p>Aggiungi la tua prima nota!</p>
                    </div>
                `;
                return;
            }
            
            let notesHTML = '';
            notes.forEach(note => {
                const createDate = new Date(note.createdAt).toLocaleDateString('it-IT');
                
                notesHTML += `
                    <div class="note-item" data-id="${note.id}">
                        <div class="note-header">
                            <div class="note-title">${note.title}</div>
                            <div class="note-date">${createDate}</div>
                        </div>
                        <div class="note-content">${note.content}</div>
                        <div class="note-actions">
                            <button class="action-btn" onclick="deleteNote(${note.id})">
                                <i class="fas fa-trash-alt"></i> Elimina
                            </button>
                        </div>
                    </div>
                `;
            });
            
            notesList.innerHTML = notesHTML;
        }
        
        function addExampleNotes() {
            const exampleNotes = [
                {
                    id: 1,
                    title: 'Regole del tono 3',
                    content: 'Quando due toni 3 si incontrano, il primo diventa tono 2. Es: 你好 (nǐ hǎo) diventa ní hǎo.',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    title: 'Ordine dei tratti',
                    content: 'Regole base: 1. Da sinistra a destra, 2. Dall\'alto al basso, 3. Prima orizzontali poi verticali, 4. Prima le linee che attraversano.',
                    createdAt: new Date().toISOString()
                }
            ];
            
            notes = exampleNotes;
            saveNotes();
        }
        
        function deleteNote(id) {
            if (confirm('Eliminare questa nota?')) {
                notes = notes.filter(note => note.id !== id);
                saveNotes();
                renderNotes();
                updateStatistics();
            }
        }
        
        // ========== STATISTICHE E GRAFICI ==========
        
        function updateStatistics() {
            // Statistiche parole
            statsTotalWords.textContent = words.length;
            
            const today = new Date().toISOString().split('T')[0];
            const todayWords = words.filter(word => word.dateAdded === today).length;
            statsTodayWords.textContent = todayWords;
            
            const reviewWords = words.filter(word => word.needsReview).length;
            statsReviewWords.textContent = reviewWords;
            
            const favoriteWords = words.filter(word => word.favorite).length;
            statsFavoriteWords.textContent = favoriteWords;
            
            // Altre statistiche
            statsAudioCount.textContent = audios.length;
            statsDrawingsCount.textContent = drawings.length;
            statsNotesCount.textContent = notes.length;
            statsEventsCount.textContent = events.length;
            
            // Attività recente
            renderRecentActivity();
        }
        
        function renderRecentActivity() {
            // Combina tutte le attività
            let allActivities = [];
            
            // Aggiungi parole
            words.slice(0, 5).forEach(word => {
                allActivities.push({
                    type: 'word',
                    title: `Aggiunta parola: ${word.chinese}`,
                    date: word.dateAdded,
                    content: `${word.pinyin} - ${word.translation}`
                });
            });
            
            // Aggiungi eventi recenti
            events.slice(0, 3).forEach(event => {
                allActivities.push({
                    type: 'event',
                    title: `Evento: ${event.title}`,
                    date: event.date,
                    content: event.description || 'Nessuna descrizione'
                });
            });
            
            // Aggiungi note recenti
            notes.slice(0, 3).forEach(note => {
                allActivities.push({
                    type: 'note',
                    title: `Nota: ${note.title}`,
                    date: note.createdAt.split('T')[0],
                    content: note.content.substring(0, 50) + (note.content.length > 50 ? '...' : '')
                });
            });
            
            // Ordina per data (più recenti prima)
            allActivities.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (allActivities.length === 0) {
                recentActivity.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <h3>Nessuna attività ancora</h3>
                        <p>Inizia ad aggiungere parole per vedere la tua attività!</p>
                    </div>
                `;
                return;
            }
            
            let activityHTML = '';
            allActivities.slice(0, 5).forEach(activity => {
                const date = new Date(activity.date).toLocaleDateString('it-IT');
                let icon = '';
                let color = '';
                
                switch(activity.type) {
                    case 'word':
                        icon = 'fas fa-book';
                        color = 'var(--primary)';
                        break;
                    case 'event':
                        icon = 'fas fa-calendar';
                        color = 'var(--orange)';
                        break;
                    case 'note':
                        icon = 'fas fa-sticky-note';
                        color = 'var(--purple)';
                        break;
                }
                
                activityHTML += `
                    <div class="event-item">
                        <div class="event-header">
                            <div class="event-title" style="color: ${color};"><i class="${icon}"></i> ${activity.title}</div>
                            <div class="event-date">${date}</div>
                        </div>
                        <div class="event-description">${activity.content}</div>
                    </div>
                `;
            });
            
            recentActivity.innerHTML = activityHTML;
        }
        
        function initCharts() {
            const wordsCtx = document.getElementById('words-chart').getContext('2d');
            const categoriesCtx = document.getElementById('categories-chart').getContext('2d');
            
            // Inizializza i grafici
            wordsChart = new Chart(wordsCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Parole Imparate',
                        data: [],
                        borderColor: '#d32f2f',
                        backgroundColor: 'rgba(211, 47, 47, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
            
            categoriesChart = new Chart(categoriesCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: []
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            updateCharts();
        }
        
        function updateCharts() {
            if (!wordsChart || !categoriesChart) return;
            
            // Grafico parole per giorno (ultimi 7 giorni)
            const today = new Date();
            const last7Days = [];
            const wordCounts = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateString = date.toISOString().split('T')[0];
                
                // Formatta la data per l'etichetta
                const label = date.toLocaleDateString('it-IT', { day: 'numeric', month: 'short' });
                last7Days.push(label);
                
                // Conta le parole aggiunte in quel giorno
                const count = words.filter(word => word.dateAdded === dateString).length;
                wordCounts.push(count);
            }
            
            wordsChart.data.labels = last7Days;
            wordsChart.data.datasets[0].data = wordCounts;
            wordsChart.update();
            
            // Grafico distribuzione categorie
            const categoryCounts = {};
            const categoryColors = {};
            
            // Inizializza con tutte le categorie
            categories.forEach(category => {
                categoryCounts[category.name] = 0;
                categoryColors[category.name] = category.color;
            });
            
            // Conta parole per categoria
            words.forEach(word => {
                if (categoryCounts[word.category] !== undefined) {
                    categoryCounts[word.category]++;
                } else {
                    categoryCounts[word.category] = 1;
                    categoryColors[word.category] = '#cccccc';
                }
            });
            
            // Rimuovi categorie con 0 parole
            Object.keys(categoryCounts).forEach(category => {
                if (categoryCounts[category] === 0) {
                    delete categoryCounts[category];
                    delete categoryColors[category];
                }
            });
            
            // Aggiorna il grafico
            categoriesChart.data.labels = Object.keys(categoryCounts);
            categoriesChart.data.datasets[0].data = Object.values(categoryCounts);
            categoriesChart.data.datasets[0].backgroundColor = Object.keys(categoryCounts).map(cat => categoryColors[cat]);
            categoriesChart.update();
        }
        
        // Esponi funzioni globalmente
        window.toggleFavorite = toggleFavorite;
        window.markAsReviewed = markAsReviewed;
        window.deleteWord = deleteWord;
        window.playAudio = playAudio;
        window.deleteAudio = deleteAudio;
        window.deleteDrawing = deleteDrawing;
        window.deleteNote = deleteNote;
        window.deleteEvent = deleteEvent;
        window.removeCategory = removeCategory;
    </script>
</body>
</html>